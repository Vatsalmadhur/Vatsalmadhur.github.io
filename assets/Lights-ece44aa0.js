import{e as Mr,I as kt,S as Ir,D as Zr,f as Wr,H as Se,g as Ue,h as Ze,L as Re,R as rr,i as Lt,C as Be,k as $r,O as Pt,P as Xr,W as Yr,U as ur,l as Ht,m as Gt,n as mr,b as We,o as zt,p as Zt,q as Wt,s as $t,t as wr,d as Xt,v as cr,w as Yt,x as qt,y as Hr,z as Vt,V as ze,N as Kt,u as tr,r as U,a as hr,A as Jt,E as Qt,G as jt,J as ea,K as ra,Q as ta,X as aa,_ as _r,Y as yr,j as Gr,c as He}from"./index-38cfac6e.js";import{v as qr}from"./constants-ac7be96b.js";try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new n.Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="6eac8537-b03e-4ac5-acd7-1fb97b90cc60",n._sentryDebugIdIdentifier="sentry-dbid-6eac8537-b03e-4ac5-acd7-1fb97b90cc60")}catch{}try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new n.Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="3fdf7e11-c640-4426-9185-e2fe676da768",n._sentryDebugIdIdentifier="sentry-dbid-3fdf7e11-c640-4426-9185-e2fe676da768")}catch{}var Ee=Uint8Array,ke=Uint16Array,Er=Uint32Array,Vr=new Ee([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Kr=new Ee([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),na=new Ee([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jr=function(n,t){for(var i=new ke(31),c=0;c<31;++c)i[c]=t+=1<<n[c-1];for(var u=new Er(i[30]),c=1;c<30;++c)for(var h=i[c];h<i[c+1];++h)u[h]=h-i[c]<<5|c;return[i,u]},Qr=Jr(Vr,2),jr=Qr[0],ia=Qr[1];jr[28]=258,ia[258]=28;var oa=Jr(Kr,0),sa=oa[0],Sr=new ke(32768);for(var re=0;re<32768;++re){var Ne=(re&43690)>>>1|(re&21845)<<1;Ne=(Ne&52428)>>>2|(Ne&13107)<<2,Ne=(Ne&61680)>>>4|(Ne&3855)<<4,Sr[re]=((Ne&65280)>>>8|(Ne&255)<<8)>>>1}var er=function(n,t,i){for(var c=n.length,u=0,h=new ke(t);u<c;++u)++h[n[u]-1];var d=new ke(t);for(u=0;u<t;++u)d[u]=d[u-1]+h[u-1]<<1;var p;if(i){p=new ke(1<<t);var f=15-t;for(u=0;u<c;++u)if(n[u])for(var g=u<<4|n[u],T=t-n[u],C=d[n[u]-1]++<<T,I=C|(1<<T)-1;C<=I;++C)p[Sr[C]>>>f]=g}else for(p=new ke(c),u=0;u<c;++u)n[u]&&(p[u]=Sr[d[n[u]-1]++]>>>15-n[u]);return p},nr=new Ee(288);for(var re=0;re<144;++re)nr[re]=8;for(var re=144;re<256;++re)nr[re]=9;for(var re=256;re<280;++re)nr[re]=7;for(var re=280;re<288;++re)nr[re]=8;var et=new Ee(32);for(var re=0;re<32;++re)et[re]=5;var la=er(nr,9,1),ca=er(et,5,1),pr=function(n){for(var t=n[0],i=1;i<n.length;++i)n[i]>t&&(t=n[i]);return t},be=function(n,t,i){var c=t/8|0;return(n[c]|n[c+1]<<8)>>(t&7)&i},fr=function(n,t){var i=t/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(t&7)},ua=function(n){return(n/8|0)+(n&7&&1)},ha=function(n,t,i){(t==null||t<0)&&(t=0),(i==null||i>n.length)&&(i=n.length);var c=new(n instanceof ke?ke:n instanceof Er?Er:Ee)(i-t);return c.set(n.subarray(t,i)),c},da=function(n,t,i){var c=n.length;if(!c||i&&!i.l&&c<5)return t||new Ee(0);var u=!t||i,h=!i||i.i;i||(i={}),t||(t=new Ee(c*3));var d=function(X){var xe=t.length;if(X>xe){var Ae=new Ee(Math.max(xe*2,X));Ae.set(t),t=Ae}},p=i.f||0,f=i.p||0,g=i.b||0,T=i.l,C=i.d,I=i.m,k=i.n,L=c*8;do{if(!T){i.f=p=be(n,f,1);var le=be(n,f+1,3);if(f+=3,le)if(le==1)T=la,C=ca,I=9,k=5;else if(le==2){var se=be(n,f,31)+257,ce=be(n,f+10,15)+4,z=se+be(n,f+5,31)+1;f+=14;for(var N=new Ee(z),te=new Ee(19),S=0;S<ce;++S)te[na[S]]=be(n,f+S*3,7);f+=ce*3;for(var b=pr(te),P=(1<<b)-1,$=er(te,b,1),S=0;S<z;){var H=$[be(n,f,P)];f+=H&15;var G=H>>>4;if(G<16)N[S++]=G;else{var Z=0,A=0;for(G==16?(A=3+be(n,f,3),f+=2,Z=N[S-1]):G==17?(A=3+be(n,f,7),f+=3):G==18&&(A=11+be(n,f,127),f+=7);A--;)N[S++]=Z}}var ae=N.subarray(0,se),D=N.subarray(se);I=pr(ae),k=pr(D),T=er(ae,I,1),C=er(D,k,1)}else throw"invalid block type";else{var G=ua(f)+4,J=n[G-4]|n[G-3]<<8,Q=G+J;if(Q>c){if(h)throw"unexpected EOF";break}u&&d(g+J),t.set(n.subarray(G,Q),g),i.b=g+=J,i.p=f=Q*8;continue}if(f>L){if(h)throw"unexpected EOF";break}}u&&d(g+131072);for(var Me=(1<<I)-1,Le=(1<<k)-1,Ie=f;;Ie=f){var Z=T[fr(n,f)&Me],j=Z>>>4;if(f+=Z&15,f>L){if(h)throw"unexpected EOF";break}if(!Z)throw"invalid length/literal";if(j<256)t[g++]=j;else if(j==256){Ie=f,T=null;break}else{var Oe=j-254;if(j>264){var S=j-257,ne=Vr[S];Oe=be(n,f,(1<<ne)-1)+jr[S],f+=ne}var de=C[fr(n,f)&Le],Te=de>>>4;if(!de)throw"invalid distance";f+=de&15;var D=sa[Te];if(Te>3){var ne=Kr[Te];D+=fr(n,f)&(1<<ne)-1,f+=ne}if(f>L){if(h)throw"unexpected EOF";break}u&&d(g+131072);for(var Xe=g+Oe;g<Xe;g+=4)t[g]=t[g-D],t[g+1]=t[g+1-D],t[g+2]=t[g+2-D],t[g+3]=t[g+3-D];g=Xe}}i.l=T,i.p=Ie,i.b=g,T&&(p=1,i.m=I,i.d=C,i.n=k)}while(!p);return g==t.length?t:ha(t,0,g)},va=new Ee(0),pa=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sr(n,t){return da((pa(n),n.subarray(2,-4)),t)}var fa=typeof TextDecoder<"u"&&new TextDecoder,ga=0;try{fa.decode(va,{stream:!0}),ga=1}catch{}const ma=n=>n&&n.isCubeTexture;class wa extends Mr{constructor(t,i){var c,u;const h=ma(t),p=((u=h?(c=t.image[0])==null?void 0:c.width:t.image.width)!=null?u:1024)/4,f=Math.floor(Math.log2(p)),g=Math.pow(2,f),T=3*Math.max(g,16*7),C=4*g,I=[h?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/T}`,`#define CUBEUV_TEXEL_HEIGHT ${1/C}`,`#define CUBEUV_MAX_MIP ${f}.0`],k=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,L=I.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${qr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,le={map:{value:t},height:{value:(i==null?void 0:i.height)||15},radius:{value:(i==null?void 0:i.radius)||100}},G=new kt(1,16),J=new Ir({uniforms:le,fragmentShader:L,vertexShader:k,side:Zr});super(G,J)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class _a extends Wr{constructor(t){super(t),this.type=Se}parse(t){const d=function(S,b){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(b||""))}},T=`
`,C=function(S,b,P){b=b||1024;let H=S.pos,Z=-1,A=0,ae="",D=String.fromCharCode.apply(null,new Uint16Array(S.subarray(H,H+128)));for(;0>(Z=D.indexOf(T))&&A<b&&H<S.byteLength;)ae+=D,A+=D.length,H+=128,D+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(H,H+128)));return-1<Z?(P!==!1&&(S.pos+=A+Z+1),ae+D.slice(0,Z)):!1},I=function(S){const b=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,$=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,H=/^\s*FORMAT=(\S+)\s*$/,Z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,A={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ae,D;for((S.pos>=S.byteLength||!(ae=C(S)))&&d(1,"no header found"),(D=ae.match(b))||d(3,"bad initial token"),A.valid|=1,A.programtype=D[1],A.string+=ae+`
`;ae=C(S),ae!==!1;){if(A.string+=ae+`
`,ae.charAt(0)==="#"){A.comments+=ae+`
`;continue}if((D=ae.match(P))&&(A.gamma=parseFloat(D[1])),(D=ae.match($))&&(A.exposure=parseFloat(D[1])),(D=ae.match(H))&&(A.valid|=2,A.format=D[1]),(D=ae.match(Z))&&(A.valid|=4,A.height=parseInt(D[1],10),A.width=parseInt(D[2],10)),A.valid&2&&A.valid&4)break}return A.valid&2||d(3,"missing format specifier"),A.valid&4||d(3,"missing image size specifier"),A},k=function(S,b,P){const $=b;if($<8||$>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);$!==(S[2]<<8|S[3])&&d(3,"wrong scanline width");const H=new Uint8Array(4*b*P);H.length||d(4,"unable to allocate buffer space");let Z=0,A=0;const ae=4*$,D=new Uint8Array(4),Me=new Uint8Array(ae);let Le=P;for(;Le>0&&A<S.byteLength;){A+4>S.byteLength&&d(1),D[0]=S[A++],D[1]=S[A++],D[2]=S[A++],D[3]=S[A++],(D[0]!=2||D[1]!=2||(D[2]<<8|D[3])!=$)&&d(3,"bad rgbe scanline format");let Ie=0,j;for(;Ie<ae&&A<S.byteLength;){j=S[A++];const ne=j>128;if(ne&&(j-=128),(j===0||Ie+j>ae)&&d(3,"bad scanline data"),ne){const de=S[A++];for(let Te=0;Te<j;Te++)Me[Ie++]=de}else Me.set(S.subarray(A,A+j),Ie),Ie+=j,A+=j}const Oe=$;for(let ne=0;ne<Oe;ne++){let de=0;H[Z]=Me[ne+de],de+=$,H[Z+1]=Me[ne+de],de+=$,H[Z+2]=Me[ne+de],de+=$,H[Z+3]=Me[ne+de],Z+=4}Le--}return H},L=function(S,b,P,$){const H=S[b+3],Z=Math.pow(2,H-128)/255;P[$+0]=S[b+0]*Z,P[$+1]=S[b+1]*Z,P[$+2]=S[b+2]*Z,P[$+3]=1},le=function(S,b,P,$){const H=S[b+3],Z=Math.pow(2,H-128)/255;P[$+0]=Ze.toHalfFloat(Math.min(S[b+0]*Z,65504)),P[$+1]=Ze.toHalfFloat(Math.min(S[b+1]*Z,65504)),P[$+2]=Ze.toHalfFloat(Math.min(S[b+2]*Z,65504)),P[$+3]=Ze.toHalfFloat(1)},G=new Uint8Array(t);G.pos=0;const J=I(G),Q=J.width,se=J.height,ce=k(G.subarray(G.pos),Q,se);let z,N,te;switch(this.type){case Ue:te=ce.length/4;const S=new Float32Array(te*4);for(let P=0;P<te;P++)L(ce,P*4,S,P*4);z=S,N=Ue;break;case Se:te=ce.length/4;const b=new Uint16Array(te*4);for(let P=0;P<te;P++)le(ce,P*4,b,P*4);z=b,N=Se;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:Q,height:se,data:z,header:J.string,gamma:J.gamma,exposure:J.exposure,type:N}}setDataType(t){return this.type=t,this}load(t,i,c,u){function h(d,p){switch(d.type){case Ue:case Se:"colorSpace"in d?d.colorSpace="srgb-linear":d.encoding=3e3,d.minFilter=Re,d.magFilter=Re,d.generateMipmaps=!1,d.flipY=!0;break}i&&i(d,p)}return super.load(t,h,c,u)}}const Qe=qr>=152;class ya extends Wr{constructor(t){super(t),this.type=Se}parse(t){const b=Math.pow(2.7182818,2.2);function P(e,r){for(var a=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[a++]=o);for(var s=a-1;a<65536;)r[a++]=0;return s}function $(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const H={l:0,c:0,lc:0};function Z(e,r,a,o,s){for(;a<e;)r=r<<8|Lr(o,s),a+=8;a-=e,H.l=r>>a&(1<<e)-1,H.c=r,H.lc=a}const A=new Array(59);function ae(e){for(var r=0;r<=58;++r)A[r]=0;for(var r=0;r<65537;++r)A[e[r]]+=1;for(var a=0,r=58;r>0;--r){var o=a+A[r]>>1;A[r]=a,a=o}for(var r=0;r<65537;++r){var s=e[r];s>0&&(e[r]=s|A[s]++<<6)}}function D(e,r,a,o,s,l,m){for(var v=a,y=0,_=0;s<=l;s++){if(v.value-a.value>o)return!1;Z(6,y,_,e,v);var E=H.l;if(y=H.c,_=H.lc,m[s]=E,E==63){if(v.value-a.value>o)throw"Something wrong with hufUnpackEncTable";Z(8,y,_,e,v);var w=H.l+6;if(y=H.c,_=H.lc,s+w>l+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)m[s++]=0;s--}else if(E>=59){var w=E-59+2;if(s+w>l+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)m[s++]=0;s--}}ae(m)}function Me(e){return e&63}function Le(e){return e>>6}function Ie(e,r,a,o){for(;r<=a;r++){var s=Le(e[r]),l=Me(e[r]);if(s>>l)throw"Invalid table entry";if(l>14){var m=o[s>>l-14];if(m.len)throw"Invalid table entry";if(m.lit++,m.p){var v=m.p;m.p=new Array(m.lit);for(var y=0;y<m.lit-1;++y)m.p[y]=v[y]}else m.p=new Array(1);m.p[m.lit-1]=r}else if(l)for(var _=0,y=1<<14-l;y>0;y--){var m=o[(s<<14-l)+_];if(m.len||m.p)throw"Invalid table entry";m.len=l,m.lit=r,_++}}return!0}const j={c:0,lc:0};function Oe(e,r,a,o){e=e<<8|Lr(a,o),r+=8,j.c=e,j.lc=r}const ne={c:0,lc:0};function de(e,r,a,o,s,l,m,v,y,_){if(e==r){o<8&&(Oe(a,o,s,m),a=j.c,o=j.lc),o-=8;var E=a>>o,E=new Uint8Array([E])[0];if(y.value+E>_)return!1;for(var w=v[y.value-1];E-- >0;)v[y.value++]=w}else if(y.value<_)v[y.value++]=e;else return!1;ne.c=a,ne.lc=o}function Te(e){return e&65535}function Xe(e){var r=Te(e);return r>32767?r-65536:r}const X={a:0,b:0};function xe(e,r){var a=Xe(e),o=Xe(r),s=o,l=a+(s&1)+(s>>1),m=l,v=l-s;X.a=m,X.b=v}function Ae(e,r){var a=Te(e),o=Te(r),s=a-(o>>1)&65535,l=o+s-32768&65535;X.a=l,X.b=s}function st(e,r,a,o,s,l,m){for(var v=m<16384,y=a>s?s:a,_=1,E;_<=y;)_<<=1;for(_>>=1,E=_,_>>=1;_>=1;){for(var w=0,oe=w+l*(s-E),R=l*_,x=l*E,F=o*_,O=o*E,Y,V,ue,fe;w<=oe;w+=x){for(var K=w,Ce=w+o*(a-E);K<=Ce;K+=O){var ee=K+F,he=K+R,Fe=he+F;v?(xe(e[K+r],e[he+r]),Y=X.a,ue=X.b,xe(e[ee+r],e[Fe+r]),V=X.a,fe=X.b,xe(Y,V),e[K+r]=X.a,e[ee+r]=X.b,xe(ue,fe),e[he+r]=X.a,e[Fe+r]=X.b):(Ae(e[K+r],e[he+r]),Y=X.a,ue=X.b,Ae(e[ee+r],e[Fe+r]),V=X.a,fe=X.b,Ae(Y,V),e[K+r]=X.a,e[ee+r]=X.b,Ae(ue,fe),e[he+r]=X.a,e[Fe+r]=X.b)}if(a&_){var he=K+R;v?xe(e[K+r],e[he+r]):Ae(e[K+r],e[he+r]),Y=X.a,e[he+r]=X.b,e[K+r]=Y}}if(s&_)for(var K=w,Ce=w+o*(a-E);K<=Ce;K+=O){var ee=K+F;v?xe(e[K+r],e[ee+r]):Ae(e[K+r],e[ee+r]),Y=X.a,e[ee+r]=X.b,e[K+r]=Y}E=_,_>>=1}return w}function lt(e,r,a,o,s,l,m,v,y,_){for(var E=0,w=0,oe=v,R=Math.trunc(s.value+(l+7)/8);s.value<R;)for(Oe(E,w,a,s),E=j.c,w=j.lc;w>=14;){var x=E>>w-14&16383,F=r[x];if(F.len)w-=F.len,de(F.lit,m,E,w,a,o,s,y,_,oe),E=ne.c,w=ne.lc;else{if(!F.p)throw"hufDecode issues";var O;for(O=0;O<F.lit;O++){for(var Y=Me(e[F.p[O]]);w<Y&&s.value<R;)Oe(E,w,a,s),E=j.c,w=j.lc;if(w>=Y&&Le(e[F.p[O]])==(E>>w-Y&(1<<Y)-1)){w-=Y,de(F.p[O],m,E,w,a,o,s,y,_,oe),E=ne.c,w=ne.lc;break}}if(O==F.lit)throw"hufDecode issues"}}var V=8-l&7;for(E>>=V,w-=V;w>0;){var F=r[E<<14-w&16383];if(F.len)w-=F.len,de(F.lit,m,E,w,a,o,s,y,_,oe),E=ne.c,w=ne.lc;else throw"hufDecode issues"}return!0}function Ur(e,r,a,o,s,l){var m={value:0},v=a.value,y=ge(r,a),_=ge(r,a);a.value+=4;var E=ge(r,a);if(a.value+=4,y<0||y>=65537||_<0||_>=65537)throw"Something wrong with HUF_ENCSIZE";var w=new Array(65537),oe=new Array(16384);$(oe);var R=o-(a.value-v);if(D(e,r,a,R,y,_,w),E>8*(o-(a.value-v)))throw"Something wrong with hufUncompress";Ie(w,y,_,oe),lt(w,oe,e,r,a,E,_,l,s,m)}function ct(e,r,a){for(var o=0;o<a;++o)r[o]=e[r[o]]}function Or(e){for(var r=1;r<e.length;r++){var a=e[r-1]+e[r]-128;e[r]=a}}function Dr(e,r){for(var a=0,o=Math.floor((e.length+1)/2),s=0,l=e.length-1;!(s>l||(r[s++]=e[a++],s>l));)r[s++]=e[o++]}function Nr(e){for(var r=e.byteLength,a=new Array,o=0,s=new DataView(e);r>0;){var l=s.getInt8(o++);if(l<0){var m=-l;r-=m+1;for(var v=0;v<m;v++)a.push(s.getUint8(o++))}else{var m=l;r-=2;for(var y=s.getUint8(o++),v=0;v<m+1;v++)a.push(y)}}return a}function ut(e,r,a,o,s,l){var ee=new DataView(l.buffer),m=a[e.idx[0]].width,v=a[e.idx[0]].height,y=3,_=Math.floor(m/8),E=Math.ceil(m/8),w=Math.ceil(v/8),oe=m-(E-1)*8,R=v-(w-1)*8,x={value:0},F=new Array(y),O=new Array(y),Y=new Array(y),V=new Array(y),ue=new Array(y);for(let q=0;q<y;++q)ue[q]=r[e.idx[q]],F[q]=q<1?0:F[q-1]+E*w,O[q]=new Float32Array(64),Y[q]=new Uint16Array(64),V[q]=new Uint16Array(E*64);for(let q=0;q<w;++q){var fe=8;q==w-1&&(fe=R);var K=8;for(let ie=0;ie<E;++ie){ie==E-1&&(K=oe);for(let W=0;W<y;++W)Y[W].fill(0),Y[W][0]=s[F[W]++],ht(x,o,Y[W]),dt(Y[W],O[W]),vt(O[W]);pt(O);for(let W=0;W<y;++W)ft(O[W],V[W],ie*64)}let pe=0;for(let ie=0;ie<y;++ie){const W=a[e.idx[ie]].type;for(let ye=8*q;ye<8*q+fe;++ye){pe=ue[ie][ye];for(let Pe=0;Pe<_;++Pe){const me=Pe*64+(ye&7)*8;ee.setUint16(pe+0*2*W,V[ie][me+0],!0),ee.setUint16(pe+1*2*W,V[ie][me+1],!0),ee.setUint16(pe+2*2*W,V[ie][me+2],!0),ee.setUint16(pe+3*2*W,V[ie][me+3],!0),ee.setUint16(pe+4*2*W,V[ie][me+4],!0),ee.setUint16(pe+5*2*W,V[ie][me+5],!0),ee.setUint16(pe+6*2*W,V[ie][me+6],!0),ee.setUint16(pe+7*2*W,V[ie][me+7],!0),pe+=8*2*W}}if(_!=E)for(let ye=8*q;ye<8*q+fe;++ye){const Pe=ue[ie][ye]+8*_*2*W,me=_*64+(ye&7)*8;for(let De=0;De<K;++De)ee.setUint16(Pe+De*2*W,V[ie][me+De],!0)}}}for(var Ce=new Uint16Array(m),ee=new DataView(l.buffer),he=0;he<y;++he){a[e.idx[he]].decoded=!0;var Fe=a[e.idx[he]].type;if(a[he].type==2)for(var Je=0;Je<v;++Je){const q=ue[he][Je];for(var _e=0;_e<m;++_e)Ce[_e]=ee.getUint16(q+_e*2*Fe,!0);for(var _e=0;_e<m;++_e)ee.setFloat32(q+_e*2*Fe,M(Ce[_e]),!0)}}}function ht(e,r,a){for(var o,s=1;s<64;)o=r[e.value],o==65280?s=64:o>>8==255?s+=o&255:(a[s]=o,s++),e.value++}function dt(e,r){r[0]=M(e[0]),r[1]=M(e[1]),r[2]=M(e[5]),r[3]=M(e[6]),r[4]=M(e[14]),r[5]=M(e[15]),r[6]=M(e[27]),r[7]=M(e[28]),r[8]=M(e[2]),r[9]=M(e[4]),r[10]=M(e[7]),r[11]=M(e[13]),r[12]=M(e[16]),r[13]=M(e[26]),r[14]=M(e[29]),r[15]=M(e[42]),r[16]=M(e[3]),r[17]=M(e[8]),r[18]=M(e[12]),r[19]=M(e[17]),r[20]=M(e[25]),r[21]=M(e[30]),r[22]=M(e[41]),r[23]=M(e[43]),r[24]=M(e[9]),r[25]=M(e[11]),r[26]=M(e[18]),r[27]=M(e[24]),r[28]=M(e[31]),r[29]=M(e[40]),r[30]=M(e[44]),r[31]=M(e[53]),r[32]=M(e[10]),r[33]=M(e[19]),r[34]=M(e[23]),r[35]=M(e[32]),r[36]=M(e[39]),r[37]=M(e[45]),r[38]=M(e[52]),r[39]=M(e[54]),r[40]=M(e[20]),r[41]=M(e[22]),r[42]=M(e[33]),r[43]=M(e[38]),r[44]=M(e[46]),r[45]=M(e[51]),r[46]=M(e[55]),r[47]=M(e[60]),r[48]=M(e[21]),r[49]=M(e[34]),r[50]=M(e[37]),r[51]=M(e[47]),r[52]=M(e[50]),r[53]=M(e[56]),r[54]=M(e[59]),r[55]=M(e[61]),r[56]=M(e[35]),r[57]=M(e[36]),r[58]=M(e[48]),r[59]=M(e[49]),r[60]=M(e[57]),r[61]=M(e[58]),r[62]=M(e[62]),r[63]=M(e[63])}function vt(e){const r=.5*Math.cos(.7853975),a=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),s=.5*Math.cos(3*3.14159/16),l=.5*Math.cos(5*3.14159/16),m=.5*Math.cos(3*3.14159/8),v=.5*Math.cos(7*3.14159/16);for(var y=new Array(4),_=new Array(4),E=new Array(4),w=new Array(4),oe=0;oe<8;++oe){var R=oe*8;y[0]=o*e[R+2],y[1]=m*e[R+2],y[2]=o*e[R+6],y[3]=m*e[R+6],_[0]=a*e[R+1]+s*e[R+3]+l*e[R+5]+v*e[R+7],_[1]=s*e[R+1]-v*e[R+3]-a*e[R+5]-l*e[R+7],_[2]=l*e[R+1]-a*e[R+3]+v*e[R+5]+s*e[R+7],_[3]=v*e[R+1]-l*e[R+3]+s*e[R+5]-a*e[R+7],E[0]=r*(e[R+0]+e[R+4]),E[3]=r*(e[R+0]-e[R+4]),E[1]=y[0]+y[3],E[2]=y[1]-y[2],w[0]=E[0]+E[1],w[1]=E[3]+E[2],w[2]=E[3]-E[2],w[3]=E[0]-E[1],e[R+0]=w[0]+_[0],e[R+1]=w[1]+_[1],e[R+2]=w[2]+_[2],e[R+3]=w[3]+_[3],e[R+4]=w[3]-_[3],e[R+5]=w[2]-_[2],e[R+6]=w[1]-_[1],e[R+7]=w[0]-_[0]}for(var x=0;x<8;++x)y[0]=o*e[16+x],y[1]=m*e[16+x],y[2]=o*e[48+x],y[3]=m*e[48+x],_[0]=a*e[8+x]+s*e[24+x]+l*e[40+x]+v*e[56+x],_[1]=s*e[8+x]-v*e[24+x]-a*e[40+x]-l*e[56+x],_[2]=l*e[8+x]-a*e[24+x]+v*e[40+x]+s*e[56+x],_[3]=v*e[8+x]-l*e[24+x]+s*e[40+x]-a*e[56+x],E[0]=r*(e[x]+e[32+x]),E[3]=r*(e[x]-e[32+x]),E[1]=y[0]+y[3],E[2]=y[1]-y[2],w[0]=E[0]+E[1],w[1]=E[3]+E[2],w[2]=E[3]-E[2],w[3]=E[0]-E[1],e[0+x]=w[0]+_[0],e[8+x]=w[1]+_[1],e[16+x]=w[2]+_[2],e[24+x]=w[3]+_[3],e[32+x]=w[3]-_[3],e[40+x]=w[2]-_[2],e[48+x]=w[1]-_[1],e[56+x]=w[0]-_[0]}function pt(e){for(var r=0;r<64;++r){var a=e[0][r],o=e[1][r],s=e[2][r];e[0][r]=a+1.5747*s,e[1][r]=a-.1873*o-.4682*s,e[2][r]=a+1.8556*o}}function ft(e,r,a){for(var o=0;o<64;++o)r[a+o]=Ze.toHalfFloat(gt(e[o]))}function gt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(b,Math.abs(e)-1)}function Br(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function mt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(Nr(r)),o=new Uint8Array(a.length);return Or(a),Dr(a,o),new DataView(o.buffer)}function vr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=sr(r),o=new Uint8Array(a.length);return Or(a),Dr(a,o),new DataView(o.buffer)}function wt(e){for(var r=e.viewer,a={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),l=0,m=new Array(e.channels),v=0;v<e.channels;v++)m[v]={},m[v].start=l,m[v].end=m[v].start,m[v].nx=e.width,m[v].ny=e.lines,m[v].size=e.type,l+=m[v].nx*m[v].ny*m[v].size;var y=qe(r,a),_=qe(r,a);if(_>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(y<=_)for(var v=0;v<_-y+1;v++)s[v+y]=Ge(r,a);var E=new Uint16Array(65536),w=P(s,E),oe=ge(r,a);Ur(e.array,r,a,oe,o,l);for(var v=0;v<e.channels;++v)for(var R=m[v],x=0;x<m[v].size;++x)st(o,R.start+x,R.nx,R.size,R.ny,R.nx*R.size,w);ct(E,o,l);for(var F=0,O=new Uint8Array(o.buffer.byteLength),Y=0;Y<e.lines;Y++)for(var V=0;V<e.channels;V++){var R=m[V],ue=R.nx*R.size,fe=new Uint8Array(o.buffer,R.end*2,ue*2);O.set(fe,F),F+=ue*2,R.end+=ue}return new DataView(O.buffer)}function _t(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=sr(r);const o=e.lines*e.channels*e.width,s=e.type==1?new Uint16Array(o):new Uint32Array(o);let l=0,m=0;const v=new Array(4);for(let y=0;y<e.lines;y++)for(let _=0;_<e.channels;_++){let E=0;switch(e.type){case 1:v[0]=l,v[1]=v[0]+e.width,l=v[1]+e.width;for(let w=0;w<e.width;++w){const oe=a[v[0]++]<<8|a[v[1]++];E+=oe,s[m]=E,m++}break;case 2:v[0]=l,v[1]=v[0]+e.width,v[2]=v[1]+e.width,l=v[2]+e.width;for(let w=0;w<e.width;++w){const oe=a[v[0]++]<<24|a[v[1]++]<<16|a[v[2]++]<<8;E+=oe,s[m]=E,m++}break}}return new DataView(s.buffer)}function kr(e){var r=e.viewer,a={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),s={version:we(r,a),unknownUncompressedSize:we(r,a),unknownCompressedSize:we(r,a),acCompressedSize:we(r,a),dcCompressedSize:we(r,a),rleCompressedSize:we(r,a),rleUncompressedSize:we(r,a),rleRawSize:we(r,a),totalAcUncompressedCount:we(r,a),totalDcUncompressedCount:we(r,a),acCompression:we(r,a)};if(s.version<2)throw"EXRLoader.parse: "+Ke.compression+" version "+s.version+" is unsupported";for(var l=new Array,m=qe(r,a)-2;m>0;){var v=ir(r.buffer,a),y=Ge(r,a),_=y>>2&3,E=(y>>4)-1,w=new Int8Array([E])[0],oe=Ge(r,a);l.push({name:v,index:w,type:oe,compression:_}),m-=v.length+3}for(var R=Ke.channels,x=new Array(e.channels),F=0;F<e.channels;++F){var O=x[F]={},Y=R[F];O.name=Y.name,O.compression=0,O.decoded=!1,O.type=Y.pixelType,O.pLinear=Y.pLinear,O.width=e.width,O.height=e.lines}for(var V={idx:new Array(3)},ue=0;ue<e.channels;++ue)for(var O=x[ue],F=0;F<l.length;++F){var fe=l[F];O.name==fe.name&&(O.compression=fe.compression,fe.index>=0&&(V.idx[fe.index]=ue),O.offset=ue)}if(s.acCompressedSize>0)switch(s.acCompression){case 0:var ee=new Uint16Array(s.totalAcUncompressedCount);Ur(e.array,r,a,s.acCompressedSize,ee,s.totalAcUncompressedCount);break;case 1:var K=e.array.slice(a.value,a.value+s.totalAcUncompressedCount),Ce=sr(K),ee=new Uint16Array(Ce.buffer);a.value+=s.totalAcUncompressedCount;break}if(s.dcCompressedSize>0){var he={array:e.array,offset:a,size:s.dcCompressedSize},Fe=new Uint16Array(vr(he).buffer);a.value+=s.dcCompressedSize}if(s.rleRawSize>0){var K=e.array.slice(a.value,a.value+s.rleCompressedSize),Ce=sr(K),Je=Nr(Ce.buffer);a.value+=s.rleCompressedSize}for(var _e=0,q=new Array(x.length),F=0;F<q.length;++F)q[F]=new Array;for(var pe=0;pe<e.lines;++pe)for(var ie=0;ie<x.length;++ie)q[ie].push(_e),_e+=x[ie].width*e.type*2;ut(V,q,x,ee,Fe,o);for(var F=0;F<x.length;++F){var O=x[F];if(!O.decoded)switch(O.compression){case 2:for(var W=0,ye=0,pe=0;pe<e.lines;++pe){for(var Pe=q[F][W],me=0;me<O.width;++me){for(var De=0;De<2*O.type;++De)o[Pe++]=Je[ye+De*O.width*O.height];ye++}W++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function ir(e,r){for(var a=new Uint8Array(e),o=0;a[r.value+o]!=0;)o+=1;var s=new TextDecoder().decode(a.slice(r.value,r.value+o));return r.value=r.value+o+1,s}function yt(e,r,a){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+a));return r.value=r.value+a,o}function Et(e,r){var a=Ye(e,r),o=ge(e,r);return[a,o]}function St(e,r){var a=ge(e,r),o=ge(e,r);return[a,o]}function Ye(e,r){var a=e.getInt32(r.value,!0);return r.value=r.value+4,a}function ge(e,r){var a=e.getUint32(r.value,!0);return r.value=r.value+4,a}function Lr(e,r){var a=e[r.value];return r.value=r.value+1,a}function Ge(e,r){var a=e.getUint8(r.value);return r.value=r.value+1,a}const we=function(e,r){let a;return"getBigInt64"in DataView.prototype?a=Number(e.getBigInt64(r.value,!0)):a=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,a};function ve(e,r){var a=e.getFloat32(r.value,!0);return r.value+=4,a}function Mt(e,r){return Ze.toHalfFloat(ve(e,r))}function M(e){var r=(e&31744)>>10,a=e&1023;return(e>>15?-1:1)*(r?r===31?a?NaN:1/0:Math.pow(2,r-15)*(1+a/1024):6103515625e-14*(a/1024))}function qe(e,r){var a=e.getUint16(r.value,!0);return r.value+=2,a}function It(e,r){return M(qe(e,r))}function bt(e,r,a,o){for(var s=a.value,l=[];a.value<s+o-1;){var m=ir(r,a),v=Ye(e,a),y=Ge(e,a);a.value+=3;var _=Ye(e,a),E=Ye(e,a);l.push({name:m,pixelType:v,pLinear:y,xSampling:_,ySampling:E})}return a.value+=1,l}function Tt(e,r){var a=ve(e,r),o=ve(e,r),s=ve(e,r),l=ve(e,r),m=ve(e,r),v=ve(e,r),y=ve(e,r),_=ve(e,r);return{redX:a,redY:o,greenX:s,greenY:l,blueX:m,blueY:v,whiteX:y,whiteY:_}}function Ct(e,r){var a=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=Ge(e,r);return a[o]}function Rt(e,r){var a=ge(e,r),o=ge(e,r),s=ge(e,r),l=ge(e,r);return{xMin:a,yMin:o,xMax:s,yMax:l}}function xt(e,r){var a=["INCREASING_Y"],o=Ge(e,r);return a[o]}function At(e,r){var a=ve(e,r),o=ve(e,r);return[a,o]}function Ft(e,r){var a=ve(e,r),o=ve(e,r),s=ve(e,r);return[a,o,s]}function Ut(e,r,a,o,s){if(o==="string"||o==="stringvector"||o==="iccProfile")return yt(r,a,s);if(o==="chlist")return bt(e,r,a,s);if(o==="chromaticities")return Tt(e,a);if(o==="compression")return Ct(e,a);if(o==="box2i")return Rt(e,a);if(o==="lineOrder")return xt(e,a);if(o==="float")return ve(e,a);if(o==="v2f")return At(e,a);if(o==="v3f")return Ft(e,a);if(o==="int")return Ye(e,a);if(o==="rational")return Et(e,a);if(o==="timecode")return St(e,a);if(o==="preview")return a.value+=s,"skipped";a.value+=s}function Ot(e,r,a){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const s=e.getUint8(5);o.spec={singleTile:!!(s&2),longName:!!(s&4),deepFormat:!!(s&8),multiPart:!!(s&16)},a.value=8;for(var l=!0;l;){var m=ir(r,a);if(m==0)l=!1;else{var v=ir(r,a),y=ge(e,a),_=Ut(e,r,a,v,y);_===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${v}'.`):o[m]=_}}if(s&-5)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function Dt(e,r,a,o,s){const l={size:0,viewer:r,array:a,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Qe?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":l.lines=1,l.uncompress=Br;break;case"RLE_COMPRESSION":l.lines=1,l.uncompress=mt;break;case"ZIPS_COMPRESSION":l.lines=1,l.uncompress=vr;break;case"ZIP_COMPRESSION":l.lines=16,l.uncompress=vr;break;case"PIZ_COMPRESSION":l.lines=32,l.uncompress=wt;break;case"PXR24_COMPRESSION":l.lines=16,l.uncompress=_t;break;case"DWAA_COMPRESSION":l.lines=32,l.uncompress=kr;break;case"DWAB_COMPRESSION":l.lines=256,l.uncompress=kr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(l.scanlineBlockSize=l.lines,l.type==1)switch(s){case Ue:l.getter=It,l.inputSize=2;break;case Se:l.getter=qe,l.inputSize=2;break}else if(l.type==2)switch(s){case Ue:l.getter=ve,l.inputSize=4;break;case Se:l.getter=Mt,l.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+l.type+" for "+e.compression+".";l.blockCount=(e.dataWindow.yMax+1)/l.scanlineBlockSize;for(var m=0;m<l.blockCount;m++)we(r,o);l.outputChannels=l.channels==3?4:l.channels;const v=l.width*l.height*l.outputChannels;switch(s){case Ue:l.byteArray=new Float32Array(v),l.channels<l.outputChannels&&l.byteArray.fill(1,0,v);break;case Se:l.byteArray=new Uint16Array(v),l.channels<l.outputChannels&&l.byteArray.fill(15360,0,v);break;default:console.error("THREE.EXRLoader: unsupported type: ",s);break}return l.bytesPerLine=l.width*l.inputSize*l.channels,l.outputChannels==4?l.format=rr:l.format=Lt,Qe?l.colorSpace="srgb-linear":l.encoding=3e3,l}const or=new DataView(t),Nt=new Uint8Array(t),Ve={value:0},Ke=Ot(or,t,Ve),B=Dt(Ke,or,Nt,Ve,this.type),Pr={value:0},Bt={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<B.height/B.scanlineBlockSize;e++){const r=ge(or,Ve);B.size=ge(or,Ve),B.lines=r+B.scanlineBlockSize>B.height?B.height-r:B.scanlineBlockSize;const o=B.size<B.lines*B.bytesPerLine?B.uncompress(B):Br(B);Ve.value+=B.size;for(let s=0;s<B.scanlineBlockSize;s++){const l=s+e*B.scanlineBlockSize;if(l>=B.height)break;for(let m=0;m<B.channels;m++){const v=Bt[Ke.channels[m].name];for(let y=0;y<B.width;y++){Pr.value=(s*(B.channels*B.width)+m*B.width+y)*B.inputSize;const _=(B.height-1-l)*(B.width*B.outputChannels)+y*B.outputChannels+v;B.byteArray[_]=B.getter(o,Pr)}}}}return{header:Ke,width:B.width,height:B.height,data:B.byteArray,format:B.format,[Qe?"colorSpace":"encoding"]:B[Qe?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,i,c,u){function h(d,p){Qe?d.colorSpace=p.colorSpace:d.encoding=p.encoding,d.minFilter=Re,d.magFilter=Re,d.generateMipmaps=!1,d.flipY=!1,i&&i(d,p)}return super.load(t,h,c,u)}}const Ea=3e3,Sa=3001,rt=(n,t,i)=>{let c;switch(n){case wr:c=new Uint8ClampedArray(t*i*4);break;case Se:c=new Uint16Array(t*i*4);break;case $t:c=new Uint32Array(t*i*4);break;case Wt:c=new Int8Array(t*i*4);break;case Zt:c=new Int16Array(t*i*4);break;case zt:c=new Int32Array(t*i*4);break;case Ue:c=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return c};let lr;const Ma=(n,t,i,c)=>{if(lr!==void 0)return lr;const u=new Yr(1,1,c);t.setRenderTarget(u);const h=new Mr(new Xr,new Xt({color:16777215}));t.render(h,i),t.setRenderTarget(null);const d=rt(n,u.width,u.height);return t.readRenderTargetPixels(u,0,0,u.width,u.height,d),u.dispose(),h.geometry.dispose(),h.material.dispose(),lr=d[0]!==0,lr};class br{constructor(t){var i,c,u,h,d,p,f,g,T,C,I,k,L,le,G,J;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(se){throw this._renderer.setRenderTarget(null),se}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const Q={format:rr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((i=t.renderTargetOptions)===null||i===void 0?void 0:i.anisotropy)!==void 0?(c=t.renderTargetOptions)===null||c===void 0?void 0:c.anisotropy:1,generateMipmaps:((u=t.renderTargetOptions)===null||u===void 0?void 0:u.generateMipmaps)!==void 0?(h=t.renderTargetOptions)===null||h===void 0?void 0:h.generateMipmaps:!1,magFilter:((d=t.renderTargetOptions)===null||d===void 0?void 0:d.magFilter)!==void 0?(p=t.renderTargetOptions)===null||p===void 0?void 0:p.magFilter:Re,minFilter:((f=t.renderTargetOptions)===null||f===void 0?void 0:f.minFilter)!==void 0?(g=t.renderTargetOptions)===null||g===void 0?void 0:g.minFilter:Re,samples:((T=t.renderTargetOptions)===null||T===void 0?void 0:T.samples)!==void 0?(C=t.renderTargetOptions)===null||C===void 0?void 0:C.samples:void 0,wrapS:((I=t.renderTargetOptions)===null||I===void 0?void 0:I.wrapS)!==void 0?(k=t.renderTargetOptions)===null||k===void 0?void 0:k.wrapS:Be,wrapT:((L=t.renderTargetOptions)===null||L===void 0?void 0:L.wrapT)!==void 0?(le=t.renderTargetOptions)===null||le===void 0?void 0:le.wrapT:Be};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=br.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new $r,this._camera=new Pt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Ma(this._type,this._renderer,this._camera,Q)){let se;switch(this._type){case Se:se=this._renderer.extensions.has("EXT_color_buffer_float")?Ue:void 0;break}se!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ue}`),this._type=se):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Mr(new Xr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Yr(this.width,this.height,Q),this._renderTarget.texture.mapping=((G=t.renderTargetOptions)===null||G===void 0?void 0:G.mapping)!==void 0?(J=t.renderTargetOptions)===null||J===void 0?void 0:J.mapping:ur}static instantiateRenderer(){const t=new Ht;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=rt(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const i=new Gt(this.toArray(),this.width,this.height,rr,this._type,(t==null?void 0:t.mapping)||ur,(t==null?void 0:t.wrapS)||Be,(t==null?void 0:t.wrapT)||Be,(t==null?void 0:t.magFilter)||Re,(t==null?void 0:t.minFilter)||Re,(t==null?void 0:t.anisotropy)||1,mr);return i.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Ir&&Object.values(this.material.uniforms).forEach(i=>{i.value instanceof We&&i.value.dispose()}),Object.values(this.material).forEach(i=>{i instanceof We&&i.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Ia=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,ba=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ta extends Ir{constructor({gamma:t,offsetHdr:i,offsetSdr:c,gainMapMin:u,gainMapMax:h,maxDisplayBoost:d,hdrCapacityMin:p,hdrCapacityMax:f,sdr:g,gainMap:T}){super({name:"GainMapDecoderMaterial",vertexShader:Ia,fragmentShader:ba,uniforms:{sdr:{value:g},gainMap:{value:T},gamma:{value:new ze(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new ze().fromArray(i)},offsetSdr:{value:new ze().fromArray(c)},gainMapMin:{value:new ze().fromArray(u)},gainMapMax:{value:new ze().fromArray(h)},weightFactor:{value:(Math.log2(d)-p)/(f-p)}},blending:Kt,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=d,this._hdrCapacityMin=p,this._hdrCapacityMax=f,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const i=this.uniforms.gamma.value;i.x=1/t[0],i.y=1/t[1],i.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class tt extends Error{}class at extends Error{}const je=(n,t,i)=>{const c=new RegExp(`${t}="([^"]*)"`,"i").exec(n);if(c)return c[1];const u=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(n);if(u){const h=u[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return h&&h.length===3?h.map(d=>d.replace(/<\/?rdf:li>/g,"")):u[1].trim()}if(i!==void 0)return i;throw new Error(`Can't find ${t} in gainmap metadata`)},Ca=n=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(n):t=n.toString();let i=t.indexOf("<x:xmpmeta");for(;i!==-1;){const c=t.indexOf("x:xmpmeta>",i),u=t.slice(i,c+10);try{const h=je(u,"hdrgm:GainMapMin","0"),d=je(u,"hdrgm:GainMapMax"),p=je(u,"hdrgm:Gamma","1"),f=je(u,"hdrgm:OffsetSDR","0.015625"),g=je(u,"hdrgm:OffsetHDR","0.015625"),T=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(u),C=T?T[1]:"0",I=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(u);if(!I)throw new Error("Incomplete gainmap metadata");const k=I[1];return{gainMapMin:Array.isArray(h)?h.map(L=>parseFloat(L)):[parseFloat(h),parseFloat(h),parseFloat(h)],gainMapMax:Array.isArray(d)?d.map(L=>parseFloat(L)):[parseFloat(d),parseFloat(d),parseFloat(d)],gamma:Array.isArray(p)?p.map(L=>parseFloat(L)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetSdr:Array.isArray(f)?f.map(L=>parseFloat(L)):[parseFloat(f),parseFloat(f),parseFloat(f)],offsetHdr:Array.isArray(g)?g.map(L=>parseFloat(L)):[parseFloat(g),parseFloat(g),parseFloat(g)],hdrCapacityMin:parseFloat(C),hdrCapacityMax:parseFloat(k)}}catch{}i=t.indexOf("<x:xmpmeta",c)}};class Ra{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((i,c)=>{const u=this.options.debug,h=new DataView(t.buffer);if(h.getUint16(0)!==65496){c(new Error("Not a valid jpeg"));return}const d=h.byteLength;let p=2,f=0,g;for(;p<d;){if(++f>250){c(new Error(`Found no marker after ${f} loops ðŸ˜µ`));return}if(h.getUint8(p)!==255){c(new Error(`Not a valid marker at offset 0x${p.toString(16)}, found: 0x${h.getUint8(p).toString(16)}`));return}if(g=h.getUint8(p+1),u&&console.log(`Marker: ${g.toString(16)}`),g===226){u&&console.log("Found APP2 marker (0xffe2)");const T=p+4;if(h.getUint32(T)===1297106432){const C=T+4;let I;if(h.getUint16(C)===18761)I=!1;else if(h.getUint16(C)===19789)I=!0;else{c(new Error("No valid endianness marker found in TIFF header"));return}if(h.getUint16(C+2,!I)!==42){c(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const k=h.getUint32(C+4,!I);if(k<8){c(new Error("Not valid TIFF data! (First offset less than 8)"));return}const L=C+k,le=h.getUint16(L,!I),G=L+2;let J=0;for(let z=G;z<G+12*le;z+=12)h.getUint16(z,!I)===45057&&(J=h.getUint32(z+8,!I));const Q=4,se=L+2+le*12+Q,ce=[];for(let z=se;z<se+J*16;z+=16){const N={MPType:h.getUint32(z,!I),size:h.getUint32(z+4,!I),dataOffset:h.getUint32(z+8,!I),dependantImages:h.getUint32(z+12,!I),start:-1,end:-1,isFII:!1};N.dataOffset?(N.start=C+N.dataOffset,N.isFII=!1):(N.start=0,N.isFII=!0),N.end=N.start+N.size,ce.push(N)}if(this.options.extractNonFII&&ce.length){const z=new Blob([h]),N=[];for(const te of ce){if(te.isFII&&!this.options.extractFII)continue;const S=z.slice(te.start,te.end+1,"image/jpeg");N.push(S)}i(N)}}}p+=2+h.getUint16(p+2)}})}}const xa=async n=>{const t=Ca(n);if(!t)throw new at("Gain map XMP metadata not found");const c=await new Ra({extractFII:!0,extractNonFII:!0}).extract(n);if(c.length!==2)throw new tt("Gain map recovery image not found");return{sdr:new Uint8Array(await c[0].arrayBuffer()),gainMap:new Uint8Array(await c[1].arrayBuffer()),metadata:t}},zr=n=>new Promise((t,i)=>{const c=document.createElement("img");c.onload=()=>{t(c)},c.onerror=u=>{i(u)},c.src=URL.createObjectURL(n)});class nt extends Yt{constructor(t,i){super(i),t&&(this._renderer=t),this._internalLoadingManager=new qt}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new Ta({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new We,sdr:new We});return new br({width:16,height:16,type:Se,colorSpace:mr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,i,c,u){const h=u?new Blob([u],{type:"image/jpeg"}):void 0,d=new Blob([c],{type:"image/jpeg"});let p,f,g=!1;if(typeof createImageBitmap>"u"){const I=await Promise.all([h?zr(h):Promise.resolve(void 0),zr(d)]);f=I[0],p=I[1],g=!0}else{const I=await Promise.all([h?createImageBitmap(h,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(d,{imageOrientation:"flipY"})]);f=I[0],p=I[1]}const T=new We(f||new ImageData(2,2),ur,Be,Be,Re,Hr,rr,wr,1,mr);T.flipY=g,T.needsUpdate=!0;const C=new We(p,ur,Be,Be,Re,Hr,rr,wr,1,Vt);C.flipY=g,C.needsUpdate=!0,t.width=p.width,t.height=p.height,t.material.gainMap=T,t.material.sdr=C,t.material.gainMapMin=i.gainMapMin,t.material.gainMapMax=i.gainMapMax,t.material.offsetHdr=i.offsetHdr,t.material.offsetSdr=i.offsetSdr,t.material.gamma=i.gamma,t.material.hdrCapacityMin=i.hdrCapacityMin,t.material.hdrCapacityMax=i.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,i.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class Aa extends nt{load([t,i,c],u,h,d){const p=this.prepareQuadRenderer();let f,g,T;const C=async()=>{if(f&&g&&T){try{await this.render(p,T,f,g)}catch(b){this.manager.itemError(t),this.manager.itemError(i),this.manager.itemError(c),typeof d=="function"&&d(b),p.disposeOnDemandRenderer();return}typeof u=="function"&&u(p),this.manager.itemEnd(t),this.manager.itemEnd(i),this.manager.itemEnd(c),p.disposeOnDemandRenderer()}};let I=!0,k=0,L=0,le=!0,G=0,J=0,Q=!0,se=0,ce=0;const z=()=>{if(typeof h=="function"){const b=k+G+se,P=L+J+ce,$=I&&le&&Q;h(new ProgressEvent("progress",{lengthComputable:$,loaded:P,total:b}))}};this.manager.itemStart(t),this.manager.itemStart(i),this.manager.itemStart(c);const N=new cr(this._internalLoadingManager);N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(t,async b=>{if(typeof b=="string")throw new Error("Invalid sdr buffer");f=b,await C()},b=>{I=b.lengthComputable,L=b.loaded,k=b.total,z()},b=>{this.manager.itemError(t),typeof d=="function"&&d(b)});const te=new cr(this._internalLoadingManager);te.setResponseType("arraybuffer"),te.setRequestHeader(this.requestHeader),te.setPath(this.path),te.setWithCredentials(this.withCredentials),te.load(i,async b=>{if(typeof b=="string")throw new Error("Invalid gainmap buffer");g=b,await C()},b=>{le=b.lengthComputable,J=b.loaded,G=b.total,z()},b=>{this.manager.itemError(i),typeof d=="function"&&d(b)});const S=new cr(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(c,async b=>{if(typeof b!="string")throw new Error("Invalid metadata string");T=JSON.parse(b),await C()},b=>{Q=b.lengthComputable,ce=b.loaded,se=b.total,z()},b=>{this.manager.itemError(c),typeof d=="function"&&d(b)}),p}}class Fa extends nt{load(t,i,c,u){const h=this.prepareQuadRenderer(),d=new cr(this._internalLoadingManager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(this.withCredentials),this.manager.itemStart(t),d.load(t,async p=>{if(typeof p=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const f=new Uint8Array(p);let g,T,C;try{const I=await xa(f);g=I.sdr,T=I.gainMap,C=I.metadata}catch(I){if(I instanceof at||I instanceof tt)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),C={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},g=f;else throw I}try{await this.render(h,C,g,T)}catch(I){this.manager.itemError(t),typeof u=="function"&&u(I),h.disposeOnDemandRenderer();return}typeof i=="function"&&i(h),this.manager.itemEnd(t),h.disposeOnDemandRenderer()},c,p=>{this.manager.itemError(t),typeof u=="function"&&u(p)}),h}}const ar={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},it="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",$e=n=>Array.isArray(n),Tr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function dr({files:n=Tr,path:t="",preset:i=void 0,encoding:c=void 0,extensions:u}={}){let h=null,d=!1;i&&(Cr(i),n=ar[i],t=it),d=$e(n);const{extension:p,isCubemap:f}=Rr(n);if(h=xr(p),!h)throw new Error("useEnvironment: Unrecognized file extension: "+n);const g=tr(k=>k.gl);U.useLayoutEffect(()=>{if(p!=="webp"&&p!=="jpg"&&p!=="jpeg")return;function k(){hr.clear(h,d?[n]:n)}g.domElement.addEventListener("webglcontextlost",k,{once:!0})},[n,g.domElement]);const T=hr(h,d?[n]:n,k=>{(p==="webp"||p==="jpg"||p==="jpeg")&&k.setRenderer(g),k.setPath==null||k.setPath(t),u&&u(k)});let C=d?T[0]:T;if(p==="jpg"||p==="jpeg"||p==="webp"){var I;C=(I=C.renderTarget)==null?void 0:I.texture}return C.mapping=f?Jt:Qt,"colorSpace"in C?C.colorSpace=c??f?"srgb":"srgb-linear":C.encoding=c??f?Sa:Ea,C}const Ua={files:Tr,path:"",preset:void 0,extensions:void 0};dr.preload=n=>{const t={...Ua,...n};let{files:i,path:c=""}=t;const{preset:u,extensions:h}=t;u&&(Cr(u),i=ar[u],c=it);const{extension:d}=Rr(i);if(d==="webp"||d==="jpg"||d==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const p=xr(d);if(!p)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.preload(p,$e(i)?[i]:i,f=>{f.setPath==null||f.setPath(c),h&&h(f)})};const Oa={files:Tr,preset:void 0};dr.clear=n=>{const t={...Oa,...n};let{files:i}=t;const{preset:c}=t;c&&(Cr(c),i=ar[c]);const{extension:u}=Rr(i),h=xr(u);if(!h)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.clear(h,$e(i)?[i]:i)};function Cr(n){if(!(n in ar))throw new Error("Preset must be one of: "+Object.keys(ar).join(", "))}function Rr(n){var t;const i=$e(n)&&n.length===6,c=$e(n)&&n.length===3&&n.some(d=>d.endsWith("json")),u=$e(n)?n[0]:n;return{extension:i?"cube":c?"webp":u.startsWith("data:application/exr")?"exr":u.startsWith("data:application/hdr")?"hdr":u.startsWith("data:image/jpeg")?"jpg":(t=u.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:i,isGainmap:c}}function xr(n){return n==="cube"?jt:n==="hdr"?_a:n==="exr"?ya:n==="jpg"||n==="jpeg"?Fa:n==="webp"?Aa:null}const Da=n=>n.current&&n.current.isScene,Na=n=>Da(n)?n.current:n;function Ar(n,t,i,c,u={}){var h,d,p,f;u={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...u};const g=Na(t||i),T=g.background,C=g.environment,I={backgroundBlurriness:g.backgroundBlurriness,backgroundIntensity:g.backgroundIntensity,backgroundRotation:(h=(d=g.backgroundRotation)==null||d.clone==null?void 0:d.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:g.environmentIntensity,environmentRotation:(p=(f=g.environmentRotation)==null||f.clone==null?void 0:f.clone())!==null&&p!==void 0?p:[0,0,0]};return n!=="only"&&(g.environment=c),n&&(g.background=c),yr(g,u),()=>{n!=="only"&&(g.environment=C),n&&(g.background=T),yr(g,I)}}function Fr({scene:n,background:t=!1,map:i,...c}){const u=tr(h=>h.scene);return U.useLayoutEffect(()=>{if(i)return Ar(t,n,u,i,c)}),null}function ot({background:n=!1,scene:t,blur:i,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:p,...f}){const g=dr(f),T=tr(C=>C.scene);return U.useLayoutEffect(()=>Ar(n,t,T,g,{backgroundBlurriness:i??c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:p})),U.useEffect(()=>()=>{g.dispose()},[g]),null}function Ba({children:n,near:t=.1,far:i=1e3,resolution:c=256,frames:u=1,map:h,background:d=!1,blur:p,backgroundBlurriness:f,backgroundIntensity:g,backgroundRotation:T,environmentIntensity:C,environmentRotation:I,scene:k,files:L,path:le,preset:G=void 0,extensions:J}){const Q=tr(S=>S.gl),se=tr(S=>S.scene),ce=U.useRef(null),[z]=U.useState(()=>new $r),N=U.useMemo(()=>{const S=new ea(c);return S.texture.type=Se,S},[c]);U.useEffect(()=>()=>{N.dispose()},[N]),U.useLayoutEffect(()=>{if(u===1){const S=Q.autoClear;Q.autoClear=!0,ce.current.update(Q,z),Q.autoClear=S}return Ar(d,k,se,N.texture,{backgroundBlurriness:p??f,backgroundIntensity:g,backgroundRotation:T,environmentIntensity:C,environmentRotation:I})},[n,z,N.texture,k,se,d,u,Q]);let te=1;return ra(()=>{if(u===1/0||te<u){const S=Q.autoClear;Q.autoClear=!0,ce.current.update(Q,z),Q.autoClear=S,te++}}),U.createElement(U.Fragment,null,ta(U.createElement(U.Fragment,null,n,U.createElement("cubeCamera",{ref:ce,args:[t,i,N]}),L||G?U.createElement(ot,{background:!0,files:L,preset:G,path:le,extensions:J}):h?U.createElement(Fr,{background:!0,map:h,extensions:J}):null),z))}function ka(n){var t,i,c,u;const h=dr(n),d=n.map||h;U.useMemo(()=>aa({GroundProjectedEnvImpl:wa}),[]),U.useEffect(()=>()=>{h.dispose()},[h]);const p=U.useMemo(()=>[d],[d]),f=(t=n.ground)==null?void 0:t.height,g=(i=n.ground)==null?void 0:i.radius,T=(c=(u=n.ground)==null?void 0:u.scale)!==null&&c!==void 0?c:1e3;return U.createElement(U.Fragment,null,U.createElement(Fr,_r({},n,{map:d})),U.createElement("groundProjectedEnvImpl",{args:p,scale:T,height:f,radius:g}))}function La(n){return n.ground?U.createElement(ka,n):n.map?U.createElement(Fr,n):n.children?U.createElement(Ba,n):U.createElement(ot,n)}const gr=U.forwardRef(({light:n,args:t,map:i,toneMapped:c=!1,color:u="white",form:h="rect",intensity:d=1,scale:p=1,target:f=[0,0,0],children:g,...T},C)=>{const I=U.useRef(null);return U.useImperativeHandle(C,()=>I.current,[]),U.useLayoutEffect(()=>{!g&&!T.material&&(yr(I.current.material,{color:u}),I.current.material.color.multiplyScalar(d))},[u,d,g,T.material]),U.useLayoutEffect(()=>{T.rotation||I.current.quaternion.identity(),f&&!T.rotation&&(typeof f=="boolean"?I.current.lookAt(0,0,0):I.current.lookAt(Array.isArray(f)?new ze(...f):f))},[f,T.rotation]),p=Array.isArray(p)&&p.length===2?[p[0],p[1],1]:p,U.createElement("mesh",_r({ref:I,scale:p},T),h==="circle"?U.createElement("ringGeometry",{args:t||[0,.5,64]}):h==="ring"?U.createElement("ringGeometry",{args:t||[.25,.5,64]}):h==="rect"||h==="plane"?U.createElement("planeGeometry",{args:t||[1,1]}):h==="box"?U.createElement("boxGeometry",{args:t||[1,1,1]}):U.createElement(h,{args:t}),g||U.createElement("meshBasicMaterial",{toneMapped:c,map:i,side:Zr}),n&&U.createElement("pointLight",_r({castShadow:!0},n)))}),Ga=()=>Gr("group",{name:"lights",children:[He(La,{resolution:256,children:Gr("group",{children:[He(gr,{form:"rect",intensity:10,position:[-1,0,-10],scale:10,color:"#495057"}),He(gr,{form:"rect",intensity:10,position:[-10,2,1],scale:10,"rotation-y":Math.PI/2}),He(gr,{form:"rect",intensity:10,position:[10,0,1],scale:10,"rotation-y":Math.PI/2})]})}),He("spotLight",{position:[-2,10,5],angle:.15,penumbra:1,decay:0,intensity:Math.PI*.2,color:"#f8f9fa"}),He("spotLight",{position:[0,-25,10],angle:.15,penumbra:1,decay:0,intensity:Math.PI*.2,color:"#f8f9fa"}),He("spotLight",{position:[0,15,5],angle:.55,penumbra:1,decay:.1,intensity:Math.PI*3})]});export{Ga as default};
//# sourceMappingURL=Lights-ece44aa0.js.map
