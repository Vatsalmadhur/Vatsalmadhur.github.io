import{r as t,a as F}from"./index-b5b5798c.js";import{f as p,W as x,L as E,H as R,D as T,F as L,g as w}from"./OrbitControls-16041e97.js";function v(n,g,d){const u=p(r=>r.size),l=p(r=>r.viewport),a=typeof n=="number"?n:u.width*l.dpr,i=typeof g=="number"?g:u.height*l.dpr,m=(typeof n=="number"?d:n)||{},{samples:f=0,depth:c,...o}=m,s=t.useMemo(()=>{const r=new x(a,i,{minFilter:E,magFilter:E,type:R,...o});return c&&(r.depthTexture=new T(a,i,L)),r.samples=f,r},[]);return t.useLayoutEffect(()=>{s.setSize(a,i),f&&(s.samples=f)},[f,s,a,i]),t.useEffect(()=>()=>s.dispose(),[]),s}const z=n=>typeof n=="function",H=t.forwardRef(({envMap:n,resolution:g=256,frames:d=1/0,children:u,makeDefault:l,...a},i)=>{const m=p(({set:e})=>e),f=p(({camera:e})=>e),c=p(({size:e})=>e),o=t.useRef(null);t.useImperativeHandle(i,()=>o.current,[]);const s=t.useRef(null),r=v(g);t.useLayoutEffect(()=>{a.manual||o.current.updateProjectionMatrix()},[c,a]),t.useLayoutEffect(()=>{o.current.updateProjectionMatrix()}),t.useLayoutEffect(()=>{if(l){const e=f;return m(()=>({camera:o.current})),()=>m(()=>({camera:e}))}},[o,l,m]);let y=0,b=null;const h=z(u);return w(e=>{h&&(d===1/0||y<d)&&(s.current.visible=!1,e.gl.setRenderTarget(r),b=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,o.current),e.scene.background=b,e.gl.setRenderTarget(null),s.current.visible=!0,y++)}),t.createElement(t.Fragment,null,t.createElement("orthographicCamera",F({left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,ref:o},a),!h&&u),t.createElement("group",{ref:s},h&&u(r.texture)))});export{H as O};
