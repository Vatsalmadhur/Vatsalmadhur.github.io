import{_ as Ut}from"./extends-4c19d496.js";import{r as V}from"./index-05ea6ddc.js";import{$ as wr,at as Ot,au as Er,Y as Nt,av as Hr,H as Se,F as Ue,aw as ze,L as Re,ax as er,ay as Bt,af as De,az as Pr,a6 as Dt,aA as zr,W as Gr,aB as cr,aC as kt,aD as Lt,aE as gr,ak as Ge,aF as Ht,aG as Pt,aH as zt,aI as Gt,aJ as fr,x as Zt,q as lr,o as Wt,aK as $t,aL as Dr,aM as Xt,V as Ke,aN as Yt,g as rr,u as ur,aO as Vt,aP as qt,aQ as Kt,aR as Jt,j as Qt,aS as jt,aT as ea,as as kr}from"./react-three-fiber.esm-d00f1930.js";import{v as Zr}from"./Gltf-ac471500.js";var ye=Uint8Array,ke=Uint16Array,mr=Uint32Array,Wr=new ye([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$r=new ye([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ra=new ye([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xr=function(i,t){for(var n=new ke(31),c=0;c<31;++c)n[c]=t+=1<<i[c-1];for(var u=new mr(n[30]),c=1;c<30;++c)for(var h=n[c];h<n[c+1];++h)u[h]=h-n[c]<<5|c;return[n,u]},Yr=Xr(Wr,2),Vr=Yr[0],ta=Yr[1];Vr[28]=258,ta[258]=28;var aa=Xr($r,0),na=aa[0],_r=new ke(32768);for(var re=0;re<32768;++re){var Be=(re&43690)>>>1|(re&21845)<<1;Be=(Be&52428)>>>2|(Be&13107)<<2,Be=(Be&61680)>>>4|(Be&3855)<<4,_r[re]=((Be&65280)>>>8|(Be&255)<<8)>>>1}var je=function(i,t,n){for(var c=i.length,u=0,h=new ke(t);u<c;++u)++h[i[u]-1];var v=new ke(t);for(u=0;u<t;++u)v[u]=v[u-1]+h[u-1]<<1;var g;if(n){g=new ke(1<<t);var f=15-t;for(u=0;u<c;++u)if(i[u])for(var m=u<<4|i[u],x=t-i[u],C=v[i[u]-1]++<<x,T=C|(1<<x)-1;C<=T;++C)g[_r[C]>>>f]=m}else for(g=new ke(c),u=0;u<c;++u)i[u]&&(g[u]=_r[v[i[u]-1]++]>>>15-i[u]);return g},ar=new ye(288);for(var re=0;re<144;++re)ar[re]=8;for(var re=144;re<256;++re)ar[re]=9;for(var re=256;re<280;++re)ar[re]=7;for(var re=280;re<288;++re)ar[re]=8;var qr=new ye(32);for(var re=0;re<32;++re)qr[re]=5;var ia=je(ar,9,1),oa=je(qr,5,1),dr=function(i){for(var t=i[0],n=1;n<i.length;++n)i[n]>t&&(t=i[n]);return t},Te=function(i,t,n){var c=t/8|0;return(i[c]|i[c+1]<<8)>>(t&7)&n},pr=function(i,t){var n=t/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(t&7)},sa=function(i){return(i/8|0)+(i&7&&1)},la=function(i,t,n){(t==null||t<0)&&(t=0),(n==null||n>i.length)&&(n=i.length);var c=new(i instanceof ke?ke:i instanceof mr?mr:ye)(n-t);return c.set(i.subarray(t,n)),c},ca=function(i,t,n){var c=i.length;if(!c||n&&!n.l&&c<5)return t||new ye(0);var u=!t||n,h=!n||n.i;n||(n={}),t||(t=new ye(c*3));var v=function($){var xe=t.length;if($>xe){var Ae=new ye(Math.max(xe*2,$));Ae.set(t),t=Ae}},g=n.f||0,f=n.p||0,m=n.b||0,x=n.l,C=n.d,T=n.m,D=n.n,k=c*8;do{if(!x){n.f=g=Te(i,f,1);var le=Te(i,f+1,3);if(f+=3,le)if(le==1)x=ia,C=oa,T=9,D=5;else if(le==2){var se=Te(i,f,31)+257,ce=Te(i,f+10,15)+4,z=se+Te(i,f+5,31)+1;f+=14;for(var N=new ye(z),te=new ye(19),S=0;S<ce;++S)te[ra[S]]=Te(i,f+S*3,7);f+=ce*3;for(var I=dr(te),L=(1<<I)-1,W=je(te,I,1),S=0;S<z;){var H=W[Te(i,f,L)];f+=H&15;var P=H>>>4;if(P<16)N[S++]=P;else{var G=0,A=0;for(P==16?(A=3+Te(i,f,3),f+=2,G=N[S-1]):P==17?(A=3+Te(i,f,7),f+=3):P==18&&(A=11+Te(i,f,127),f+=7);A--;)N[S++]=G}}var ae=N.subarray(0,se),O=N.subarray(se);T=dr(ae),D=dr(O),x=je(ae,T,1),C=je(O,D,1)}else throw"invalid block type";else{var P=sa(f)+4,J=i[P-4]|i[P-3]<<8,Q=P+J;if(Q>c){if(h)throw"unexpected EOF";break}u&&v(m+J),t.set(i.subarray(P,Q),m),n.b=m+=J,n.p=f=Q*8;continue}if(f>k){if(h)throw"unexpected EOF";break}}u&&v(m+131072);for(var Me=(1<<T)-1,Le=(1<<D)-1,Ie=f;;Ie=f){var G=x[pr(i,f)&Me],j=G>>>4;if(f+=G&15,f>k){if(h)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(j<256)t[m++]=j;else if(j==256){Ie=f,x=null;break}else{var Oe=j-254;if(j>264){var S=j-257,ne=Wr[S];Oe=Te(i,f,(1<<ne)-1)+Vr[S],f+=ne}var ve=C[pr(i,f)&Le],be=ve>>>4;if(!ve)throw"invalid distance";f+=ve&15;var O=na[be];if(be>3){var ne=$r[be];O+=pr(i,f)&(1<<ne)-1,f+=ne}if(f>k){if(h)throw"unexpected EOF";break}u&&v(m+131072);for(var We=m+Oe;m<We;m+=4)t[m]=t[m-O],t[m+1]=t[m+1-O],t[m+2]=t[m+2-O],t[m+3]=t[m+3-O];m=We}}n.l=x,n.p=Ie,n.b=m,x&&(g=1,n.m=T,n.d=C,n.n=D)}while(!g);return m==t.length?t:la(t,0,m)},ua=new ye(0),ha=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function or(i,t){return ca((ha(i),i.subarray(2,-4)),t)}var va=typeof TextDecoder<"u"&&new TextDecoder,da=0;try{va.decode(ua,{stream:!0}),da=1}catch{}const pa=i=>i&&i.isCubeTexture;class ga extends wr{constructor(t,n){var c,u;const h=pa(t),g=((u=h?(c=t.image[0])==null?void 0:c.width:t.image.width)!=null?u:1024)/4,f=Math.floor(Math.log2(g)),m=Math.pow(2,f),x=3*Math.max(m,16*7),C=4*m,T=[h?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/x}`,`#define CUBEUV_TEXEL_HEIGHT ${1/C}`,`#define CUBEUV_MAX_MIP ${f}.0`],D=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,k=T.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Zr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,le={map:{value:t},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},P=new Ot(1,16),J=new Er({uniforms:le,fragmentShader:k,vertexShader:D,side:Nt});super(P,J)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class fa extends Hr{constructor(t){super(t),this.type=Se}parse(t){const v=function(S,I){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},x=`
`,C=function(S,I,L){I=I||1024;let H=S.pos,G=-1,A=0,ae="",O=String.fromCharCode.apply(null,new Uint16Array(S.subarray(H,H+128)));for(;0>(G=O.indexOf(x))&&A<I&&H<S.byteLength;)ae+=O,A+=O.length,H+=128,O+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(H,H+128)));return-1<G?(L!==!1&&(S.pos+=A+G+1),ae+O.slice(0,G)):!1},T=function(S){const I=/^#\?(\S+)/,L=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,W=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,H=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,A={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ae,O;for((S.pos>=S.byteLength||!(ae=C(S)))&&v(1,"no header found"),(O=ae.match(I))||v(3,"bad initial token"),A.valid|=1,A.programtype=O[1],A.string+=ae+`
`;ae=C(S),ae!==!1;){if(A.string+=ae+`
`,ae.charAt(0)==="#"){A.comments+=ae+`
`;continue}if((O=ae.match(L))&&(A.gamma=parseFloat(O[1])),(O=ae.match(W))&&(A.exposure=parseFloat(O[1])),(O=ae.match(H))&&(A.valid|=2,A.format=O[1]),(O=ae.match(G))&&(A.valid|=4,A.height=parseInt(O[1],10),A.width=parseInt(O[2],10)),A.valid&2&&A.valid&4)break}return A.valid&2||v(3,"missing format specifier"),A.valid&4||v(3,"missing image size specifier"),A},D=function(S,I,L){const W=I;if(W<8||W>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);W!==(S[2]<<8|S[3])&&v(3,"wrong scanline width");const H=new Uint8Array(4*I*L);H.length||v(4,"unable to allocate buffer space");let G=0,A=0;const ae=4*W,O=new Uint8Array(4),Me=new Uint8Array(ae);let Le=L;for(;Le>0&&A<S.byteLength;){A+4>S.byteLength&&v(1),O[0]=S[A++],O[1]=S[A++],O[2]=S[A++],O[3]=S[A++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=W)&&v(3,"bad rgbe scanline format");let Ie=0,j;for(;Ie<ae&&A<S.byteLength;){j=S[A++];const ne=j>128;if(ne&&(j-=128),(j===0||Ie+j>ae)&&v(3,"bad scanline data"),ne){const ve=S[A++];for(let be=0;be<j;be++)Me[Ie++]=ve}else Me.set(S.subarray(A,A+j),Ie),Ie+=j,A+=j}const Oe=W;for(let ne=0;ne<Oe;ne++){let ve=0;H[G]=Me[ne+ve],ve+=W,H[G+1]=Me[ne+ve],ve+=W,H[G+2]=Me[ne+ve],ve+=W,H[G+3]=Me[ne+ve],G+=4}Le--}return H},k=function(S,I,L,W){const H=S[I+3],G=Math.pow(2,H-128)/255;L[W+0]=S[I+0]*G,L[W+1]=S[I+1]*G,L[W+2]=S[I+2]*G,L[W+3]=1},le=function(S,I,L,W){const H=S[I+3],G=Math.pow(2,H-128)/255;L[W+0]=ze.toHalfFloat(Math.min(S[I+0]*G,65504)),L[W+1]=ze.toHalfFloat(Math.min(S[I+1]*G,65504)),L[W+2]=ze.toHalfFloat(Math.min(S[I+2]*G,65504)),L[W+3]=ze.toHalfFloat(1)},P=new Uint8Array(t);P.pos=0;const J=T(P),Q=J.width,se=J.height,ce=D(P.subarray(P.pos),Q,se);let z,N,te;switch(this.type){case Ue:te=ce.length/4;const S=new Float32Array(te*4);for(let L=0;L<te;L++)k(ce,L*4,S,L*4);z=S,N=Ue;break;case Se:te=ce.length/4;const I=new Uint16Array(te*4);for(let L=0;L<te;L++)le(ce,L*4,I,L*4);z=I,N=Se;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:Q,height:se,data:z,header:J.string,gamma:J.gamma,exposure:J.exposure,type:N}}setDataType(t){return this.type=t,this}load(t,n,c,u){function h(v,g){switch(v.type){case Ue:case Se:"colorSpace"in v?v.colorSpace="srgb-linear":v.encoding=3e3,v.minFilter=Re,v.magFilter=Re,v.generateMipmaps=!1,v.flipY=!0;break}n&&n(v,g)}return super.load(t,h,c,u)}}const Je=Zr>=152;class ma extends Hr{constructor(t){super(t),this.type=Se}parse(t){const I=Math.pow(2.7182818,2.2);function L(e,r){for(var a=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[a++]=o);for(var s=a-1;a<65536;)r[a++]=0;return s}function W(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const H={l:0,c:0,lc:0};function G(e,r,a,o,s){for(;a<e;)r=r<<8|Nr(o,s),a+=8;a-=e,H.l=r>>a&(1<<e)-1,H.c=r,H.lc=a}const A=new Array(59);function ae(e){for(var r=0;r<=58;++r)A[r]=0;for(var r=0;r<65537;++r)A[e[r]]+=1;for(var a=0,r=58;r>0;--r){var o=a+A[r]>>1;A[r]=a,a=o}for(var r=0;r<65537;++r){var s=e[r];s>0&&(e[r]=s|A[s]++<<6)}}function O(e,r,a,o,s,l,p){for(var d=a,E=0,w=0;s<=l;s++){if(d.value-a.value>o)return!1;G(6,E,w,e,d);var y=H.l;if(E=H.c,w=H.lc,p[s]=y,y==63){if(d.value-a.value>o)throw"Something wrong with hufUnpackEncTable";G(8,E,w,e,d);var _=H.l+6;if(E=H.c,w=H.lc,s+_>l+1)throw"Something wrong with hufUnpackEncTable";for(;_--;)p[s++]=0;s--}else if(y>=59){var _=y-59+2;if(s+_>l+1)throw"Something wrong with hufUnpackEncTable";for(;_--;)p[s++]=0;s--}}ae(p)}function Me(e){return e&63}function Le(e){return e>>6}function Ie(e,r,a,o){for(;r<=a;r++){var s=Le(e[r]),l=Me(e[r]);if(s>>l)throw"Invalid table entry";if(l>14){var p=o[s>>l-14];if(p.len)throw"Invalid table entry";if(p.lit++,p.p){var d=p.p;p.p=new Array(p.lit);for(var E=0;E<p.lit-1;++E)p.p[E]=d[E]}else p.p=new Array(1);p.p[p.lit-1]=r}else if(l)for(var w=0,E=1<<14-l;E>0;E--){var p=o[(s<<14-l)+w];if(p.len||p.p)throw"Invalid table entry";p.len=l,p.lit=r,w++}}return!0}const j={c:0,lc:0};function Oe(e,r,a,o){e=e<<8|Nr(a,o),r+=8,j.c=e,j.lc=r}const ne={c:0,lc:0};function ve(e,r,a,o,s,l,p,d,E,w){if(e==r){o<8&&(Oe(a,o,s,p),a=j.c,o=j.lc),o-=8;var y=a>>o,y=new Uint8Array([y])[0];if(E.value+y>w)return!1;for(var _=d[E.value-1];y-- >0;)d[E.value++]=_}else if(E.value<w)d[E.value++]=e;else return!1;ne.c=a,ne.lc=o}function be(e){return e&65535}function We(e){var r=be(e);return r>32767?r-65536:r}const $={a:0,b:0};function xe(e,r){var a=We(e),o=We(r),s=o,l=a+(s&1)+(s>>1),p=l,d=l-s;$.a=p,$.b=d}function Ae(e,r){var a=be(e),o=be(r),s=a-(o>>1)&65535,l=o+s-32768&65535;$.a=l,$.b=s}function tt(e,r,a,o,s,l,p){for(var d=p<16384,E=a>s?s:a,w=1,y;w<=E;)w<<=1;for(w>>=1,y=w,w>>=1;w>=1;){for(var _=0,oe=_+l*(s-y),b=l*w,R=l*y,F=o*w,U=o*y,X,q,ue,ge;_<=oe;_+=R){for(var K=_,Ce=_+o*(a-y);K<=Ce;K+=U){var ee=K+F,he=K+b,Fe=he+F;d?(xe(e[K+r],e[he+r]),X=$.a,ue=$.b,xe(e[ee+r],e[Fe+r]),q=$.a,ge=$.b,xe(X,q),e[K+r]=$.a,e[ee+r]=$.b,xe(ue,ge),e[he+r]=$.a,e[Fe+r]=$.b):(Ae(e[K+r],e[he+r]),X=$.a,ue=$.b,Ae(e[ee+r],e[Fe+r]),q=$.a,ge=$.b,Ae(X,q),e[K+r]=$.a,e[ee+r]=$.b,Ae(ue,ge),e[he+r]=$.a,e[Fe+r]=$.b)}if(a&w){var he=K+b;d?xe(e[K+r],e[he+r]):Ae(e[K+r],e[he+r]),X=$.a,e[he+r]=$.b,e[K+r]=X}}if(s&w)for(var K=_,Ce=_+o*(a-y);K<=Ce;K+=U){var ee=K+F;d?xe(e[K+r],e[ee+r]):Ae(e[K+r],e[ee+r]),X=$.a,e[ee+r]=$.b,e[K+r]=X}y=w,w>>=1}return _}function at(e,r,a,o,s,l,p,d,E,w){for(var y=0,_=0,oe=d,b=Math.trunc(s.value+(l+7)/8);s.value<b;)for(Oe(y,_,a,s),y=j.c,_=j.lc;_>=14;){var R=y>>_-14&16383,F=r[R];if(F.len)_-=F.len,ve(F.lit,p,y,_,a,o,s,E,w,oe),y=ne.c,_=ne.lc;else{if(!F.p)throw"hufDecode issues";var U;for(U=0;U<F.lit;U++){for(var X=Me(e[F.p[U]]);_<X&&s.value<b;)Oe(y,_,a,s),y=j.c,_=j.lc;if(_>=X&&Le(e[F.p[U]])==(y>>_-X&(1<<X)-1)){_-=X,ve(F.p[U],p,y,_,a,o,s,E,w,oe),y=ne.c,_=ne.lc;break}}if(U==F.lit)throw"hufDecode issues"}}var q=8-l&7;for(y>>=q,_-=q;_>0;){var F=r[y<<14-_&16383];if(F.len)_-=F.len,ve(F.lit,p,y,_,a,o,s,E,w,oe),y=ne.c,_=ne.lc;else throw"hufDecode issues"}return!0}function Rr(e,r,a,o,s,l){var p={value:0},d=a.value,E=fe(r,a),w=fe(r,a);a.value+=4;var y=fe(r,a);if(a.value+=4,E<0||E>=65537||w<0||w>=65537)throw"Something wrong with HUF_ENCSIZE";var _=new Array(65537),oe=new Array(16384);W(oe);var b=o-(a.value-d);if(O(e,r,a,b,E,w,_),y>8*(o-(a.value-d)))throw"Something wrong with hufUncompress";Ie(_,E,w,oe),at(_,oe,e,r,a,y,w,l,s,p)}function nt(e,r,a){for(var o=0;o<a;++o)r[o]=e[r[o]]}function xr(e){for(var r=1;r<e.length;r++){var a=e[r-1]+e[r]-128;e[r]=a}}function Ar(e,r){for(var a=0,o=Math.floor((e.length+1)/2),s=0,l=e.length-1;!(s>l||(r[s++]=e[a++],s>l));)r[s++]=e[o++]}function Fr(e){for(var r=e.byteLength,a=new Array,o=0,s=new DataView(e);r>0;){var l=s.getInt8(o++);if(l<0){var p=-l;r-=p+1;for(var d=0;d<p;d++)a.push(s.getUint8(o++))}else{var p=l;r-=2;for(var E=s.getUint8(o++),d=0;d<p+1;d++)a.push(E)}}return a}function it(e,r,a,o,s,l){var ee=new DataView(l.buffer),p=a[e.idx[0]].width,d=a[e.idx[0]].height,E=3,w=Math.floor(p/8),y=Math.ceil(p/8),_=Math.ceil(d/8),oe=p-(y-1)*8,b=d-(_-1)*8,R={value:0},F=new Array(E),U=new Array(E),X=new Array(E),q=new Array(E),ue=new Array(E);for(let Y=0;Y<E;++Y)ue[Y]=r[e.idx[Y]],F[Y]=Y<1?0:F[Y-1]+y*_,U[Y]=new Float32Array(64),X[Y]=new Uint16Array(64),q[Y]=new Uint16Array(y*64);for(let Y=0;Y<_;++Y){var ge=8;Y==_-1&&(ge=b);var K=8;for(let ie=0;ie<y;++ie){ie==y-1&&(K=oe);for(let Z=0;Z<E;++Z)X[Z].fill(0),X[Z][0]=s[F[Z]++],ot(R,o,X[Z]),st(X[Z],U[Z]),lt(U[Z]);ct(U);for(let Z=0;Z<E;++Z)ut(U[Z],q[Z],ie*64)}let pe=0;for(let ie=0;ie<E;++ie){const Z=a[e.idx[ie]].type;for(let Ee=8*Y;Ee<8*Y+ge;++Ee){pe=ue[ie][Ee];for(let He=0;He<w;++He){const me=He*64+(Ee&7)*8;ee.setUint16(pe+0*2*Z,q[ie][me+0],!0),ee.setUint16(pe+1*2*Z,q[ie][me+1],!0),ee.setUint16(pe+2*2*Z,q[ie][me+2],!0),ee.setUint16(pe+3*2*Z,q[ie][me+3],!0),ee.setUint16(pe+4*2*Z,q[ie][me+4],!0),ee.setUint16(pe+5*2*Z,q[ie][me+5],!0),ee.setUint16(pe+6*2*Z,q[ie][me+6],!0),ee.setUint16(pe+7*2*Z,q[ie][me+7],!0),pe+=8*2*Z}}if(w!=y)for(let Ee=8*Y;Ee<8*Y+ge;++Ee){const He=ue[ie][Ee]+8*w*2*Z,me=w*64+(Ee&7)*8;for(let Ne=0;Ne<K;++Ne)ee.setUint16(He+Ne*2*Z,q[ie][me+Ne],!0)}}}for(var Ce=new Uint16Array(p),ee=new DataView(l.buffer),he=0;he<E;++he){a[e.idx[he]].decoded=!0;var Fe=a[e.idx[he]].type;if(a[he].type==2)for(var qe=0;qe<d;++qe){const Y=ue[he][qe];for(var we=0;we<p;++we)Ce[we]=ee.getUint16(Y+we*2*Fe,!0);for(var we=0;we<p;++we)ee.setFloat32(Y+we*2*Fe,M(Ce[we]),!0)}}}function ot(e,r,a){for(var o,s=1;s<64;)o=r[e.value],o==65280?s=64:o>>8==255?s+=o&255:(a[s]=o,s++),e.value++}function st(e,r){r[0]=M(e[0]),r[1]=M(e[1]),r[2]=M(e[5]),r[3]=M(e[6]),r[4]=M(e[14]),r[5]=M(e[15]),r[6]=M(e[27]),r[7]=M(e[28]),r[8]=M(e[2]),r[9]=M(e[4]),r[10]=M(e[7]),r[11]=M(e[13]),r[12]=M(e[16]),r[13]=M(e[26]),r[14]=M(e[29]),r[15]=M(e[42]),r[16]=M(e[3]),r[17]=M(e[8]),r[18]=M(e[12]),r[19]=M(e[17]),r[20]=M(e[25]),r[21]=M(e[30]),r[22]=M(e[41]),r[23]=M(e[43]),r[24]=M(e[9]),r[25]=M(e[11]),r[26]=M(e[18]),r[27]=M(e[24]),r[28]=M(e[31]),r[29]=M(e[40]),r[30]=M(e[44]),r[31]=M(e[53]),r[32]=M(e[10]),r[33]=M(e[19]),r[34]=M(e[23]),r[35]=M(e[32]),r[36]=M(e[39]),r[37]=M(e[45]),r[38]=M(e[52]),r[39]=M(e[54]),r[40]=M(e[20]),r[41]=M(e[22]),r[42]=M(e[33]),r[43]=M(e[38]),r[44]=M(e[46]),r[45]=M(e[51]),r[46]=M(e[55]),r[47]=M(e[60]),r[48]=M(e[21]),r[49]=M(e[34]),r[50]=M(e[37]),r[51]=M(e[47]),r[52]=M(e[50]),r[53]=M(e[56]),r[54]=M(e[59]),r[55]=M(e[61]),r[56]=M(e[35]),r[57]=M(e[36]),r[58]=M(e[48]),r[59]=M(e[49]),r[60]=M(e[57]),r[61]=M(e[58]),r[62]=M(e[62]),r[63]=M(e[63])}function lt(e){const r=.5*Math.cos(.7853975),a=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),s=.5*Math.cos(3*3.14159/16),l=.5*Math.cos(5*3.14159/16),p=.5*Math.cos(3*3.14159/8),d=.5*Math.cos(7*3.14159/16);for(var E=new Array(4),w=new Array(4),y=new Array(4),_=new Array(4),oe=0;oe<8;++oe){var b=oe*8;E[0]=o*e[b+2],E[1]=p*e[b+2],E[2]=o*e[b+6],E[3]=p*e[b+6],w[0]=a*e[b+1]+s*e[b+3]+l*e[b+5]+d*e[b+7],w[1]=s*e[b+1]-d*e[b+3]-a*e[b+5]-l*e[b+7],w[2]=l*e[b+1]-a*e[b+3]+d*e[b+5]+s*e[b+7],w[3]=d*e[b+1]-l*e[b+3]+s*e[b+5]-a*e[b+7],y[0]=r*(e[b+0]+e[b+4]),y[3]=r*(e[b+0]-e[b+4]),y[1]=E[0]+E[3],y[2]=E[1]-E[2],_[0]=y[0]+y[1],_[1]=y[3]+y[2],_[2]=y[3]-y[2],_[3]=y[0]-y[1],e[b+0]=_[0]+w[0],e[b+1]=_[1]+w[1],e[b+2]=_[2]+w[2],e[b+3]=_[3]+w[3],e[b+4]=_[3]-w[3],e[b+5]=_[2]-w[2],e[b+6]=_[1]-w[1],e[b+7]=_[0]-w[0]}for(var R=0;R<8;++R)E[0]=o*e[16+R],E[1]=p*e[16+R],E[2]=o*e[48+R],E[3]=p*e[48+R],w[0]=a*e[8+R]+s*e[24+R]+l*e[40+R]+d*e[56+R],w[1]=s*e[8+R]-d*e[24+R]-a*e[40+R]-l*e[56+R],w[2]=l*e[8+R]-a*e[24+R]+d*e[40+R]+s*e[56+R],w[3]=d*e[8+R]-l*e[24+R]+s*e[40+R]-a*e[56+R],y[0]=r*(e[R]+e[32+R]),y[3]=r*(e[R]-e[32+R]),y[1]=E[0]+E[3],y[2]=E[1]-E[2],_[0]=y[0]+y[1],_[1]=y[3]+y[2],_[2]=y[3]-y[2],_[3]=y[0]-y[1],e[0+R]=_[0]+w[0],e[8+R]=_[1]+w[1],e[16+R]=_[2]+w[2],e[24+R]=_[3]+w[3],e[32+R]=_[3]-w[3],e[40+R]=_[2]-w[2],e[48+R]=_[1]-w[1],e[56+R]=_[0]-w[0]}function ct(e){for(var r=0;r<64;++r){var a=e[0][r],o=e[1][r],s=e[2][r];e[0][r]=a+1.5747*s,e[1][r]=a-.1873*o-.4682*s,e[2][r]=a+1.8556*o}}function ut(e,r,a){for(var o=0;o<64;++o)r[a+o]=ze.toHalfFloat(ht(e[o]))}function ht(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(I,Math.abs(e)-1)}function Ur(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function vt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(Fr(r)),o=new Uint8Array(a.length);return xr(a),Ar(a,o),new DataView(o.buffer)}function vr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=or(r),o=new Uint8Array(a.length);return xr(a),Ar(a,o),new DataView(o.buffer)}function dt(e){for(var r=e.viewer,a={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),l=0,p=new Array(e.channels),d=0;d<e.channels;d++)p[d]={},p[d].start=l,p[d].end=p[d].start,p[d].nx=e.width,p[d].ny=e.lines,p[d].size=e.type,l+=p[d].nx*p[d].ny*p[d].size;var E=Xe(r,a),w=Xe(r,a);if(w>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(E<=w)for(var d=0;d<w-E+1;d++)s[d+E]=Pe(r,a);var y=new Uint16Array(65536),_=L(s,y),oe=fe(r,a);Rr(e.array,r,a,oe,o,l);for(var d=0;d<e.channels;++d)for(var b=p[d],R=0;R<p[d].size;++R)tt(o,b.start+R,b.nx,b.size,b.ny,b.nx*b.size,_);nt(y,o,l);for(var F=0,U=new Uint8Array(o.buffer.byteLength),X=0;X<e.lines;X++)for(var q=0;q<e.channels;q++){var b=p[q],ue=b.nx*b.size,ge=new Uint8Array(o.buffer,b.end*2,ue*2);U.set(ge,F),F+=ue*2,b.end+=ue}return new DataView(U.buffer)}function pt(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=or(r);const o=e.lines*e.channels*e.width,s=e.type==1?new Uint16Array(o):new Uint32Array(o);let l=0,p=0;const d=new Array(4);for(let E=0;E<e.lines;E++)for(let w=0;w<e.channels;w++){let y=0;switch(e.type){case 1:d[0]=l,d[1]=d[0]+e.width,l=d[1]+e.width;for(let _=0;_<e.width;++_){const oe=a[d[0]++]<<8|a[d[1]++];y+=oe,s[p]=y,p++}break;case 2:d[0]=l,d[1]=d[0]+e.width,d[2]=d[1]+e.width,l=d[2]+e.width;for(let _=0;_<e.width;++_){const oe=a[d[0]++]<<24|a[d[1]++]<<16|a[d[2]++]<<8;y+=oe,s[p]=y,p++}break}}return new DataView(s.buffer)}function Or(e){var r=e.viewer,a={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),s={version:_e(r,a),unknownUncompressedSize:_e(r,a),unknownCompressedSize:_e(r,a),acCompressedSize:_e(r,a),dcCompressedSize:_e(r,a),rleCompressedSize:_e(r,a),rleUncompressedSize:_e(r,a),rleRawSize:_e(r,a),totalAcUncompressedCount:_e(r,a),totalDcUncompressedCount:_e(r,a),acCompression:_e(r,a)};if(s.version<2)throw"EXRLoader.parse: "+Ve.compression+" version "+s.version+" is unsupported";for(var l=new Array,p=Xe(r,a)-2;p>0;){var d=nr(r.buffer,a),E=Pe(r,a),w=E>>2&3,y=(E>>4)-1,_=new Int8Array([y])[0],oe=Pe(r,a);l.push({name:d,index:_,type:oe,compression:w}),p-=d.length+3}for(var b=Ve.channels,R=new Array(e.channels),F=0;F<e.channels;++F){var U=R[F]={},X=b[F];U.name=X.name,U.compression=0,U.decoded=!1,U.type=X.pixelType,U.pLinear=X.pLinear,U.width=e.width,U.height=e.lines}for(var q={idx:new Array(3)},ue=0;ue<e.channels;++ue)for(var U=R[ue],F=0;F<l.length;++F){var ge=l[F];U.name==ge.name&&(U.compression=ge.compression,ge.index>=0&&(q.idx[ge.index]=ue),U.offset=ue)}if(s.acCompressedSize>0)switch(s.acCompression){case 0:var ee=new Uint16Array(s.totalAcUncompressedCount);Rr(e.array,r,a,s.acCompressedSize,ee,s.totalAcUncompressedCount);break;case 1:var K=e.array.slice(a.value,a.value+s.totalAcUncompressedCount),Ce=or(K),ee=new Uint16Array(Ce.buffer);a.value+=s.totalAcUncompressedCount;break}if(s.dcCompressedSize>0){var he={array:e.array,offset:a,size:s.dcCompressedSize},Fe=new Uint16Array(vr(he).buffer);a.value+=s.dcCompressedSize}if(s.rleRawSize>0){var K=e.array.slice(a.value,a.value+s.rleCompressedSize),Ce=or(K),qe=Fr(Ce.buffer);a.value+=s.rleCompressedSize}for(var we=0,Y=new Array(R.length),F=0;F<Y.length;++F)Y[F]=new Array;for(var pe=0;pe<e.lines;++pe)for(var ie=0;ie<R.length;++ie)Y[ie].push(we),we+=R[ie].width*e.type*2;it(q,Y,R,ee,Fe,o);for(var F=0;F<R.length;++F){var U=R[F];if(!U.decoded)switch(U.compression){case 2:for(var Z=0,Ee=0,pe=0;pe<e.lines;++pe){for(var He=Y[F][Z],me=0;me<U.width;++me){for(var Ne=0;Ne<2*U.type;++Ne)o[He++]=qe[Ee+Ne*U.width*U.height];Ee++}Z++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function nr(e,r){for(var a=new Uint8Array(e),o=0;a[r.value+o]!=0;)o+=1;var s=new TextDecoder().decode(a.slice(r.value,r.value+o));return r.value=r.value+o+1,s}function gt(e,r,a){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+a));return r.value=r.value+a,o}function ft(e,r){var a=$e(e,r),o=fe(e,r);return[a,o]}function mt(e,r){var a=fe(e,r),o=fe(e,r);return[a,o]}function $e(e,r){var a=e.getInt32(r.value,!0);return r.value=r.value+4,a}function fe(e,r){var a=e.getUint32(r.value,!0);return r.value=r.value+4,a}function Nr(e,r){var a=e[r.value];return r.value=r.value+1,a}function Pe(e,r){var a=e.getUint8(r.value);return r.value=r.value+1,a}const _e=function(e,r){let a;return"getBigInt64"in DataView.prototype?a=Number(e.getBigInt64(r.value,!0)):a=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,a};function de(e,r){var a=e.getFloat32(r.value,!0);return r.value+=4,a}function _t(e,r){return ze.toHalfFloat(de(e,r))}function M(e){var r=(e&31744)>>10,a=e&1023;return(e>>15?-1:1)*(r?r===31?a?NaN:1/0:Math.pow(2,r-15)*(1+a/1024):6103515625e-14*(a/1024))}function Xe(e,r){var a=e.getUint16(r.value,!0);return r.value+=2,a}function wt(e,r){return M(Xe(e,r))}function Et(e,r,a,o){for(var s=a.value,l=[];a.value<s+o-1;){var p=nr(r,a),d=$e(e,a),E=Pe(e,a);a.value+=3;var w=$e(e,a),y=$e(e,a);l.push({name:p,pixelType:d,pLinear:E,xSampling:w,ySampling:y})}return a.value+=1,l}function yt(e,r){var a=de(e,r),o=de(e,r),s=de(e,r),l=de(e,r),p=de(e,r),d=de(e,r),E=de(e,r),w=de(e,r);return{redX:a,redY:o,greenX:s,greenY:l,blueX:p,blueY:d,whiteX:E,whiteY:w}}function St(e,r){var a=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=Pe(e,r);return a[o]}function Mt(e,r){var a=fe(e,r),o=fe(e,r),s=fe(e,r),l=fe(e,r);return{xMin:a,yMin:o,xMax:s,yMax:l}}function It(e,r){var a=["INCREASING_Y"],o=Pe(e,r);return a[o]}function Tt(e,r){var a=de(e,r),o=de(e,r);return[a,o]}function bt(e,r){var a=de(e,r),o=de(e,r),s=de(e,r);return[a,o,s]}function Ct(e,r,a,o,s){if(o==="string"||o==="stringvector"||o==="iccProfile")return gt(r,a,s);if(o==="chlist")return Et(e,r,a,s);if(o==="chromaticities")return yt(e,a);if(o==="compression")return St(e,a);if(o==="box2i")return Mt(e,a);if(o==="lineOrder")return It(e,a);if(o==="float")return de(e,a);if(o==="v2f")return Tt(e,a);if(o==="v3f")return bt(e,a);if(o==="int")return $e(e,a);if(o==="rational")return ft(e,a);if(o==="timecode")return mt(e,a);if(o==="preview")return a.value+=s,"skipped";a.value+=s}function Rt(e,r,a){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const s=e.getUint8(5);o.spec={singleTile:!!(s&2),longName:!!(s&4),deepFormat:!!(s&8),multiPart:!!(s&16)},a.value=8;for(var l=!0;l;){var p=nr(r,a);if(p==0)l=!1;else{var d=nr(r,a),E=fe(e,a),w=Ct(e,r,a,d,E);w===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${d}'.`):o[p]=w}}if(s&-5)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function xt(e,r,a,o,s){const l={size:0,viewer:r,array:a,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Je?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":l.lines=1,l.uncompress=Ur;break;case"RLE_COMPRESSION":l.lines=1,l.uncompress=vt;break;case"ZIPS_COMPRESSION":l.lines=1,l.uncompress=vr;break;case"ZIP_COMPRESSION":l.lines=16,l.uncompress=vr;break;case"PIZ_COMPRESSION":l.lines=32,l.uncompress=dt;break;case"PXR24_COMPRESSION":l.lines=16,l.uncompress=pt;break;case"DWAA_COMPRESSION":l.lines=32,l.uncompress=Or;break;case"DWAB_COMPRESSION":l.lines=256,l.uncompress=Or;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(l.scanlineBlockSize=l.lines,l.type==1)switch(s){case Ue:l.getter=wt,l.inputSize=2;break;case Se:l.getter=Xe,l.inputSize=2;break}else if(l.type==2)switch(s){case Ue:l.getter=de,l.inputSize=4;break;case Se:l.getter=_t,l.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+l.type+" for "+e.compression+".";l.blockCount=(e.dataWindow.yMax+1)/l.scanlineBlockSize;for(var p=0;p<l.blockCount;p++)_e(r,o);l.outputChannels=l.channels==3?4:l.channels;const d=l.width*l.height*l.outputChannels;switch(s){case Ue:l.byteArray=new Float32Array(d),l.channels<l.outputChannels&&l.byteArray.fill(1,0,d);break;case Se:l.byteArray=new Uint16Array(d),l.channels<l.outputChannels&&l.byteArray.fill(15360,0,d);break;default:console.error("THREE.EXRLoader: unsupported type: ",s);break}return l.bytesPerLine=l.width*l.inputSize*l.channels,l.outputChannels==4?l.format=er:l.format=Bt,Je?l.colorSpace="srgb-linear":l.encoding=3e3,l}const ir=new DataView(t),At=new Uint8Array(t),Ye={value:0},Ve=Rt(ir,t,Ye),B=xt(Ve,ir,At,Ye,this.type),Br={value:0},Ft={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<B.height/B.scanlineBlockSize;e++){const r=fe(ir,Ye);B.size=fe(ir,Ye),B.lines=r+B.scanlineBlockSize>B.height?B.height-r:B.scanlineBlockSize;const o=B.size<B.lines*B.bytesPerLine?B.uncompress(B):Ur(B);Ye.value+=B.size;for(let s=0;s<B.scanlineBlockSize;s++){const l=s+e*B.scanlineBlockSize;if(l>=B.height)break;for(let p=0;p<B.channels;p++){const d=Ft[Ve.channels[p].name];for(let E=0;E<B.width;E++){Br.value=(s*(B.channels*B.width)+p*B.width+E)*B.inputSize;const w=(B.height-1-l)*(B.width*B.outputChannels)+E*B.outputChannels+d;B.byteArray[w]=B.getter(o,Br)}}}}return{header:Ve,width:B.width,height:B.height,data:B.byteArray,format:B.format,[Je?"colorSpace":"encoding"]:B[Je?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,n,c,u){function h(v,g){Je?v.colorSpace=g.colorSpace:v.encoding=g.encoding,v.minFilter=Re,v.magFilter=Re,v.generateMipmaps=!1,v.flipY=!1,n&&n(v,g)}return super.load(t,h,c,u)}}const _a=3e3,wa=3001,Kr=(i,t,n)=>{let c;switch(i){case fr:c=new Uint8ClampedArray(t*n*4);break;case Se:c=new Uint16Array(t*n*4);break;case Gt:c=new Uint32Array(t*n*4);break;case zt:c=new Int8Array(t*n*4);break;case Pt:c=new Int16Array(t*n*4);break;case Ht:c=new Int32Array(t*n*4);break;case Ue:c=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return c};let sr;const Ea=(i,t,n,c)=>{if(sr!==void 0)return sr;const u=new Gr(1,1,c);t.setRenderTarget(u);const h=new wr(new zr,new Zt({color:16777215}));t.render(h,n),t.setRenderTarget(null);const v=Kr(i,u.width,u.height);return t.readRenderTargetPixels(u,0,0,u.width,u.height,v),u.dispose(),h.geometry.dispose(),h.material.dispose(),sr=v[0]!==0,sr};class yr{constructor(t){var n,c,u,h,v,g,f,m,x,C,T,D,k,le,P,J;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(se){throw this._renderer.setRenderTarget(null),se}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const Q={format:er,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=t.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(c=t.renderTargetOptions)===null||c===void 0?void 0:c.anisotropy:1,generateMipmaps:((u=t.renderTargetOptions)===null||u===void 0?void 0:u.generateMipmaps)!==void 0?(h=t.renderTargetOptions)===null||h===void 0?void 0:h.generateMipmaps:!1,magFilter:((v=t.renderTargetOptions)===null||v===void 0?void 0:v.magFilter)!==void 0?(g=t.renderTargetOptions)===null||g===void 0?void 0:g.magFilter:Re,minFilter:((f=t.renderTargetOptions)===null||f===void 0?void 0:f.minFilter)!==void 0?(m=t.renderTargetOptions)===null||m===void 0?void 0:m.minFilter:Re,samples:((x=t.renderTargetOptions)===null||x===void 0?void 0:x.samples)!==void 0?(C=t.renderTargetOptions)===null||C===void 0?void 0:C.samples:void 0,wrapS:((T=t.renderTargetOptions)===null||T===void 0?void 0:T.wrapS)!==void 0?(D=t.renderTargetOptions)===null||D===void 0?void 0:D.wrapS:De,wrapT:((k=t.renderTargetOptions)===null||k===void 0?void 0:k.wrapT)!==void 0?(le=t.renderTargetOptions)===null||le===void 0?void 0:le.wrapT:De};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=yr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Pr,this._camera=new Dt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Ea(this._type,this._renderer,this._camera,Q)){let se;switch(this._type){case Se:se=this._renderer.extensions.has("EXT_color_buffer_float")?Ue:void 0;break}se!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ue}`),this._type=se):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new wr(new zr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Gr(this.width,this.height,Q),this._renderTarget.texture.mapping=((P=t.renderTargetOptions)===null||P===void 0?void 0:P.mapping)!==void 0?(J=t.renderTargetOptions)===null||J===void 0?void 0:J.mapping:cr}static instantiateRenderer(){const t=new kt;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Kr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const n=new Lt(this.toArray(),this.width,this.height,er,this._type,(t==null?void 0:t.mapping)||cr,(t==null?void 0:t.wrapS)||De,(t==null?void 0:t.wrapT)||De,(t==null?void 0:t.magFilter)||Re,(t==null?void 0:t.minFilter)||Re,(t==null?void 0:t.anisotropy)||1,gr);return n.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Er&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof Ge&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof Ge&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const ya=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Sa=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ma extends Er{constructor({gamma:t,offsetHdr:n,offsetSdr:c,gainMapMin:u,gainMapMax:h,maxDisplayBoost:v,hdrCapacityMin:g,hdrCapacityMax:f,sdr:m,gainMap:x}){super({name:"GainMapDecoderMaterial",vertexShader:ya,fragmentShader:Sa,uniforms:{sdr:{value:m},gainMap:{value:x},gamma:{value:new Ke(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Ke().fromArray(n)},offsetSdr:{value:new Ke().fromArray(c)},gainMapMin:{value:new Ke().fromArray(u)},gainMapMax:{value:new Ke().fromArray(h)},weightFactor:{value:(Math.log2(v)-g)/(f-g)}},blending:Yt,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=v,this._hdrCapacityMin=g,this._hdrCapacityMax=f,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Jr extends Error{}class Qr extends Error{}const Qe=(i,t,n)=>{const c=new RegExp(`${t}="([^"]*)"`,"i").exec(i);if(c)return c[1];const u=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(i);if(u){const h=u[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return h&&h.length===3?h.map(v=>v.replace(/<\/?rdf:li>/g,"")):u[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${t} in gainmap metadata`)},Ia=i=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(i):t=i.toString();let n=t.indexOf("<x:xmpmeta");for(;n!==-1;){const c=t.indexOf("x:xmpmeta>",n),u=t.slice(n,c+10);try{const h=Qe(u,"hdrgm:GainMapMin","0"),v=Qe(u,"hdrgm:GainMapMax"),g=Qe(u,"hdrgm:Gamma","1"),f=Qe(u,"hdrgm:OffsetSDR","0.015625"),m=Qe(u,"hdrgm:OffsetHDR","0.015625"),x=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(u),C=x?x[1]:"0",T=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(u);if(!T)throw new Error("Incomplete gainmap metadata");const D=T[1];return{gainMapMin:Array.isArray(h)?h.map(k=>parseFloat(k)):[parseFloat(h),parseFloat(h),parseFloat(h)],gainMapMax:Array.isArray(v)?v.map(k=>parseFloat(k)):[parseFloat(v),parseFloat(v),parseFloat(v)],gamma:Array.isArray(g)?g.map(k=>parseFloat(k)):[parseFloat(g),parseFloat(g),parseFloat(g)],offsetSdr:Array.isArray(f)?f.map(k=>parseFloat(k)):[parseFloat(f),parseFloat(f),parseFloat(f)],offsetHdr:Array.isArray(m)?m.map(k=>parseFloat(k)):[parseFloat(m),parseFloat(m),parseFloat(m)],hdrCapacityMin:parseFloat(C),hdrCapacityMax:parseFloat(D)}}catch{}n=t.indexOf("<x:xmpmeta",c)}};class Ta{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((n,c)=>{const u=this.options.debug,h=new DataView(t.buffer);if(h.getUint16(0)!==65496){c(new Error("Not a valid jpeg"));return}const v=h.byteLength;let g=2,f=0,m;for(;g<v;){if(++f>250){c(new Error(`Found no marker after ${f} loops 😵`));return}if(h.getUint8(g)!==255){c(new Error(`Not a valid marker at offset 0x${g.toString(16)}, found: 0x${h.getUint8(g).toString(16)}`));return}if(m=h.getUint8(g+1),u&&console.log(`Marker: ${m.toString(16)}`),m===226){u&&console.log("Found APP2 marker (0xffe2)");const x=g+4;if(h.getUint32(x)===1297106432){const C=x+4;let T;if(h.getUint16(C)===18761)T=!1;else if(h.getUint16(C)===19789)T=!0;else{c(new Error("No valid endianness marker found in TIFF header"));return}if(h.getUint16(C+2,!T)!==42){c(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const D=h.getUint32(C+4,!T);if(D<8){c(new Error("Not valid TIFF data! (First offset less than 8)"));return}const k=C+D,le=h.getUint16(k,!T),P=k+2;let J=0;for(let z=P;z<P+12*le;z+=12)h.getUint16(z,!T)===45057&&(J=h.getUint32(z+8,!T));const Q=4,se=k+2+le*12+Q,ce=[];for(let z=se;z<se+J*16;z+=16){const N={MPType:h.getUint32(z,!T),size:h.getUint32(z+4,!T),dataOffset:h.getUint32(z+8,!T),dependantImages:h.getUint32(z+12,!T),start:-1,end:-1,isFII:!1};N.dataOffset?(N.start=C+N.dataOffset,N.isFII=!1):(N.start=0,N.isFII=!0),N.end=N.start+N.size,ce.push(N)}if(this.options.extractNonFII&&ce.length){const z=new Blob([h]),N=[];for(const te of ce){if(te.isFII&&!this.options.extractFII)continue;const S=z.slice(te.start,te.end+1,"image/jpeg");N.push(S)}n(N)}}}g+=2+h.getUint16(g+2)}})}}const ba=async i=>{const t=Ia(i);if(!t)throw new Qr("Gain map XMP metadata not found");const c=await new Ta({extractFII:!0,extractNonFII:!0}).extract(i);if(c.length!==2)throw new Jr("Gain map recovery image not found");return{sdr:new Uint8Array(await c[0].arrayBuffer()),gainMap:new Uint8Array(await c[1].arrayBuffer()),metadata:t}},Lr=i=>new Promise((t,n)=>{const c=document.createElement("img");c.onload=()=>{t(c)},c.onerror=u=>{n(u)},c.src=URL.createObjectURL(i)});class jr extends Wt{constructor(t,n){super(n),t&&(this._renderer=t),this._internalLoadingManager=new $t}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new Ma({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Ge,sdr:new Ge});return new yr({width:16,height:16,type:Se,colorSpace:gr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,n,c,u){const h=u?new Blob([u],{type:"image/jpeg"}):void 0,v=new Blob([c],{type:"image/jpeg"});let g,f,m=!1;if(typeof createImageBitmap>"u"){const T=await Promise.all([h?Lr(h):Promise.resolve(void 0),Lr(v)]);f=T[0],g=T[1],m=!0}else{const T=await Promise.all([h?createImageBitmap(h,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(v,{imageOrientation:"flipY"})]);f=T[0],g=T[1]}const x=new Ge(f||new ImageData(2,2),cr,De,De,Re,Dr,er,fr,1,gr);x.flipY=m,x.needsUpdate=!0;const C=new Ge(g,cr,De,De,Re,Dr,er,fr,1,Xt);C.flipY=m,C.needsUpdate=!0,t.width=g.width,t.height=g.height,t.material.gainMap=x,t.material.sdr=C,t.material.gainMapMin=n.gainMapMin,t.material.gainMapMax=n.gainMapMax,t.material.offsetHdr=n.offsetHdr,t.material.offsetSdr=n.offsetSdr,t.material.gamma=n.gamma,t.material.hdrCapacityMin=n.hdrCapacityMin,t.material.hdrCapacityMax=n.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class Ca extends jr{load([t,n,c],u,h,v){const g=this.prepareQuadRenderer();let f,m,x;const C=async()=>{if(f&&m&&x){try{await this.render(g,x,f,m)}catch(I){this.manager.itemError(t),this.manager.itemError(n),this.manager.itemError(c),typeof v=="function"&&v(I),g.disposeOnDemandRenderer();return}typeof u=="function"&&u(g),this.manager.itemEnd(t),this.manager.itemEnd(n),this.manager.itemEnd(c),g.disposeOnDemandRenderer()}};let T=!0,D=0,k=0,le=!0,P=0,J=0,Q=!0,se=0,ce=0;const z=()=>{if(typeof h=="function"){const I=D+P+se,L=k+J+ce,W=T&&le&&Q;h(new ProgressEvent("progress",{lengthComputable:W,loaded:L,total:I}))}};this.manager.itemStart(t),this.manager.itemStart(n),this.manager.itemStart(c);const N=new lr(this._internalLoadingManager);N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(t,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");f=I,await C()},I=>{T=I.lengthComputable,k=I.loaded,D=I.total,z()},I=>{this.manager.itemError(t),typeof v=="function"&&v(I)});const te=new lr(this._internalLoadingManager);te.setResponseType("arraybuffer"),te.setRequestHeader(this.requestHeader),te.setPath(this.path),te.setWithCredentials(this.withCredentials),te.load(n,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");m=I,await C()},I=>{le=I.lengthComputable,J=I.loaded,P=I.total,z()},I=>{this.manager.itemError(n),typeof v=="function"&&v(I)});const S=new lr(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(c,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");x=JSON.parse(I),await C()},I=>{Q=I.lengthComputable,ce=I.loaded,se=I.total,z()},I=>{this.manager.itemError(c),typeof v=="function"&&v(I)}),g}}class Ra extends jr{load(t,n,c,u){const h=this.prepareQuadRenderer(),v=new lr(this._internalLoadingManager);return v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setPath(this.path),v.setWithCredentials(this.withCredentials),this.manager.itemStart(t),v.load(t,async g=>{if(typeof g=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const f=new Uint8Array(g);let m,x,C;try{const T=await ba(f);m=T.sdr,x=T.gainMap,C=T.metadata}catch(T){if(T instanceof Qr||T instanceof Jr)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),C={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},m=f;else throw T}try{await this.render(h,C,m,x)}catch(T){this.manager.itemError(t),typeof u=="function"&&u(T),h.disposeOnDemandRenderer();return}typeof n=="function"&&n(h),this.manager.itemEnd(t),h.disposeOnDemandRenderer()},c,g=>{this.manager.itemError(t),typeof u=="function"&&u(g)}),h}}const tr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},et="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Ze=i=>Array.isArray(i),Sr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function hr({files:i=Sr,path:t="",preset:n=void 0,encoding:c=void 0,extensions:u}={}){let h=null,v=!1;n&&(Mr(n),i=tr[n],t=et),v=Ze(i);const{extension:g,isCubemap:f}=Ir(i);if(h=Tr(g),!h)throw new Error("useEnvironment: Unrecognized file extension: "+i);const m=rr(D=>D.gl);V.useLayoutEffect(()=>{if(g!=="webp"&&g!=="jpg"&&g!=="jpeg")return;function D(){ur.clear(h,v?[i]:i)}m.domElement.addEventListener("webglcontextlost",D,{once:!0})},[i,m.domElement]);const x=ur(h,v?[i]:i,D=>{(g==="webp"||g==="jpg"||g==="jpeg")&&D.setRenderer(m),D.setPath==null||D.setPath(t),u&&u(D)});let C=v?x[0]:x;if(g==="jpg"||g==="jpeg"||g==="webp"){var T;C=(T=C.renderTarget)==null?void 0:T.texture}return C.mapping=f?Vt:qt,"colorSpace"in C?C.colorSpace=c??f?"srgb":"srgb-linear":C.encoding=c??f?wa:_a,C}const xa={files:Sr,path:"",preset:void 0,extensions:void 0};hr.preload=i=>{const t={...xa,...i};let{files:n,path:c=""}=t;const{preset:u,extensions:h}=t;u&&(Mr(u),n=tr[u],c=et);const{extension:v}=Ir(n);if(v==="webp"||v==="jpg"||v==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const g=Tr(v);if(!g)throw new Error("useEnvironment: Unrecognized file extension: "+n);ur.preload(g,Ze(n)?[n]:n,f=>{f.setPath==null||f.setPath(c),h&&h(f)})};const Aa={files:Sr,preset:void 0};hr.clear=i=>{const t={...Aa,...i};let{files:n}=t;const{preset:c}=t;c&&(Mr(c),n=tr[c]);const{extension:u}=Ir(n),h=Tr(u);if(!h)throw new Error("useEnvironment: Unrecognized file extension: "+n);ur.clear(h,Ze(n)?[n]:n)};function Mr(i){if(!(i in tr))throw new Error("Preset must be one of: "+Object.keys(tr).join(", "))}function Ir(i){var t;const n=Ze(i)&&i.length===6,c=Ze(i)&&i.length===3&&i.some(v=>v.endsWith("json")),u=Ze(i)?i[0]:i;return{extension:n?"cube":c?"webp":u.startsWith("data:application/exr")?"exr":u.startsWith("data:application/hdr")?"hdr":u.startsWith("data:image/jpeg")?"jpg":(t=u.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:n,isGainmap:c}}function Tr(i){return i==="cube"?Kt:i==="hdr"?fa:i==="exr"?ma:i==="jpg"||i==="jpeg"?Ra:i==="webp"?Ca:null}const Fa=i=>i.current&&i.current.isScene,Ua=i=>Fa(i)?i.current:i;function br(i,t,n,c,u={}){var h,v,g,f;u={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...u};const m=Ua(t||n),x=m.background,C=m.environment,T={backgroundBlurriness:m.backgroundBlurriness,backgroundIntensity:m.backgroundIntensity,backgroundRotation:(h=(v=m.backgroundRotation)==null||v.clone==null?void 0:v.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:m.environmentIntensity,environmentRotation:(g=(f=m.environmentRotation)==null||f.clone==null?void 0:f.clone())!==null&&g!==void 0?g:[0,0,0]};return i!=="only"&&(m.environment=c),i&&(m.background=c),kr(m,u),()=>{i!=="only"&&(m.environment=C),i&&(m.background=x),kr(m,T)}}function Cr({scene:i,background:t=!1,map:n,...c}){const u=rr(h=>h.scene);return V.useLayoutEffect(()=>{if(n)return br(t,i,u,n,c)}),null}function rt({background:i=!1,scene:t,blur:n,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:v,environmentRotation:g,...f}){const m=hr(f),x=rr(C=>C.scene);return V.useLayoutEffect(()=>br(i,t,x,m,{backgroundBlurriness:n??c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:v,environmentRotation:g})),V.useEffect(()=>()=>{m.dispose()},[m]),null}function Oa({children:i,near:t=.1,far:n=1e3,resolution:c=256,frames:u=1,map:h,background:v=!1,blur:g,backgroundBlurriness:f,backgroundIntensity:m,backgroundRotation:x,environmentIntensity:C,environmentRotation:T,scene:D,files:k,path:le,preset:P=void 0,extensions:J}){const Q=rr(S=>S.gl),se=rr(S=>S.scene),ce=V.useRef(null),[z]=V.useState(()=>new Pr),N=V.useMemo(()=>{const S=new Jt(c);return S.texture.type=Se,S},[c]);V.useEffect(()=>()=>{N.dispose()},[N]),V.useLayoutEffect(()=>{if(u===1){const S=Q.autoClear;Q.autoClear=!0,ce.current.update(Q,z),Q.autoClear=S}return br(v,D,se,N.texture,{backgroundBlurriness:g??f,backgroundIntensity:m,backgroundRotation:x,environmentIntensity:C,environmentRotation:T})},[i,z,N.texture,D,se,v,u,Q]);let te=1;return Qt(()=>{if(u===1/0||te<u){const S=Q.autoClear;Q.autoClear=!0,ce.current.update(Q,z),Q.autoClear=S,te++}}),V.createElement(V.Fragment,null,jt(V.createElement(V.Fragment,null,i,V.createElement("cubeCamera",{ref:ce,args:[t,n,N]}),k||P?V.createElement(rt,{background:!0,files:k,preset:P,path:le,extensions:J}):h?V.createElement(Cr,{background:!0,map:h,extensions:J}):null),z))}function Na(i){var t,n,c,u;const h=hr(i),v=i.map||h;V.useMemo(()=>ea({GroundProjectedEnvImpl:ga}),[]),V.useEffect(()=>()=>{h.dispose()},[h]);const g=V.useMemo(()=>[v],[v]),f=(t=i.ground)==null?void 0:t.height,m=(n=i.ground)==null?void 0:n.radius,x=(c=(u=i.ground)==null?void 0:u.scale)!==null&&c!==void 0?c:1e3;return V.createElement(V.Fragment,null,V.createElement(Cr,Ut({},i,{map:v})),V.createElement("groundProjectedEnvImpl",{args:g,scale:x,height:f,radius:m}))}function Ha(i){return i.ground?V.createElement(Na,i):i.map?V.createElement(Cr,i):i.children?V.createElement(Oa,i):V.createElement(rt,i)}export{Ha as E};
